define(["./AxisAlignedBoundingBox-39ab50d0","./Matrix2-413c4048","./Matrix3-81054f0f","./defaultValue-f6d5e6da","./TerrainEncoding-bd5c9ed5","./IndexDatatype-d3db4e7d","./Math-2ce22ee9","./Transforms-fce95115","./WebMercatorProjection-943e2226","./createTaskProcessorWorker","./RuntimeError-9b4ce3fb","./AttributeCompression-48e336db","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./combine-0c102d93"],function(e,t,r,i,n,o,a,s,l,d,c,h,u,I,g){"use strict";function m(){s.DeveloperError.throwInstantiationError()}Object.defineProperties(m.prototype,{errorEvent:{get:s.DeveloperError.throwInstantiationError},credit:{get:s.DeveloperError.throwInstantiationError},tilingScheme:{get:s.DeveloperError.throwInstantiationError},ready:{get:s.DeveloperError.throwInstantiationError},readyPromise:{get:s.DeveloperError.throwInstantiationError},hasWaterMask:{get:s.DeveloperError.throwInstantiationError},hasVertexNormals:{get:s.DeveloperError.throwInstantiationError},availability:{get:s.DeveloperError.throwInstantiationError}});let T=[];m.getRegularGridIndices=function(e,t){let r=T[e];i.defined(r)||(T[e]=r=[]);let n=r[t];return i.defined(n)||(n=e*t<a.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),y(e,t,n,0)),n};let f=[];m.getRegularGridIndicesAndEdgeIndices=function(e,t){let r=f[e];i.defined(r)||(f[e]=r=[]);let n=r[t];if(!i.defined(n)){let i=m.getRegularGridIndices(e,t),o=p(e,t),a=o.westIndicesSouthToNorth,s=o.southIndicesEastToWest,l=o.eastIndicesNorthToSouth,d=o.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:l,northIndicesWestToEast:d}}return n};let E=[];function p(e,t){let r;let i=Array(t),n=Array(e),o=Array(t),a=Array(e);for(r=0;r<e;++r)a[r]=r,n[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,i[r]=(t-r-1)*e;return{westIndicesSouthToNorth:i,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function y(e,t,r,i){let n=0;for(let o=0;o<t-1;++o){for(let t=0;t<e-1;++t){let t=n,o=t+e,a=o+1,s=t+1;r[i++]=t,r[i++]=o,r[i++]=s,r[i++]=s,r[i++]=o,r[i++]=a,++n}++n}}function N(e,t,r,i){let n=e[0],o=e.length;for(let a=1;a<o;++a){let o=e[a];r[i++]=n,r[i++]=o,r[i++]=t,r[i++]=t,r[i++]=o,r[i++]=t+1,n=o,++t}return i}m.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){let r=E[e];i.defined(r)||(E[e]=r=[]);let n=r[t];if(!i.defined(n)){let i=e*t,a=(e-1)*(t-1)*6,s=2*e+2*t,l=p(e,t),d=l.westIndicesSouthToNorth,c=l.southIndicesEastToWest,h=l.eastIndicesNorthToSouth,u=l.northIndicesWestToEast,I=o.IndexDatatype.createTypedArray(i+s,a+6*Math.max(0,s-4));y(e,t,I,0),m.addSkirtIndices(d,c,h,u,i,I,a),n=r[t]={indices:I,westIndicesSouthToNorth:d,southIndicesEastToWest:c,eastIndicesNorthToSouth:h,northIndicesWestToEast:u,indexCountWithoutSkirts:a}}return n},m.addSkirtIndices=function(e,t,r,i,n,o,a){let s=n;a=N(e,s,o,a),s+=e.length,a=N(t,s,o,a),s+=t.length,a=N(r,s,o,a),N(i,s+=r.length,o,a)},m.heightmapTerrainQuality=.25,m.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*m.heightmapTerrainQuality/(t*r)},m.prototype.requestTileGeometry=s.DeveloperError.throwInstantiationError,m.prototype.getLevelMaximumGeometricError=s.DeveloperError.throwInstantiationError,m.prototype.getTileDataAvailable=s.DeveloperError.throwInstantiationError,m.prototype.loadTileDataAvailability=s.DeveloperError.throwInstantiationError;let M=new r.Cartesian3,b=new r.Cartesian3,w=new r.Cartesian3,S=new r.Cartographic,x=new t.Cartesian2;function A(e,i,n,o,s,l,d,c,h){let u=Number.POSITIVE_INFINITY,I=s.north,g=s.south,m=s.east,T=s.west;m<T&&(m+=a.CesiumMath.TWO_PI);let f=e.length;for(let s=0;s<f;++s){let f=e[s],E=n[f],p=o[f];S.longitude=a.CesiumMath.lerp(T,m,p.x),S.latitude=a.CesiumMath.lerp(g,I,p.y),S.height=E-i;let y=l.cartographicToCartesian(S,M);t.Matrix4.multiplyByPoint(d,y,y),r.Cartesian3.minimumByComponent(y,c,c),r.Cartesian3.maximumByComponent(y,h,h),u=Math.min(u,S.height)}return u}function C(e,t,r,n,o,s,d,c,h,u,I,g,m,T){let f=i.defined(d),E=h.north,p=h.south,y=h.east,N=h.west;y<N&&(y+=a.CesiumMath.TWO_PI);let b=r.length;for(let i=0;i<b;++i){let h,b;let w=r[i],A=o[w],C=s[w];S.longitude=a.CesiumMath.lerp(N,y,C.x)+m,S.latitude=a.CesiumMath.lerp(p,E,C.y)+T,S.height=A-u;let W=c.cartographicToCartesian(S,M);if(f){let e=2*w;x.x=d[e],x.y=d[e+1]}n.hasWebMercatorT&&(h=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-I)*g),n.hasGeodeticSurfaceNormals&&(b=c.geodeticSurfaceNormal(W)),t=n.encode(e,t,W,C,S.height,x,h,b)}}function W(e,t){let r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),i.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return d(function(d,c){let h,u,I;let g=d.quantizedVertices,T=g.length/3,f=d.octEncodedNormals,E=d.westIndices.length+d.eastIndices.length+d.southIndices.length+d.northIndices.length,p=d.includeWebMercatorT,y=d.exaggeration,N=d.exaggerationRelativeHeight,v=1!==y,P=t.Rectangle.clone(d.rectangle),D=P.west,k=P.south,F=P.east,H=P.north,_=r.Ellipsoid.clone(d.ellipsoid),G=d.minimumHeight,V=d.maximumHeight,Y=d.relativeToCenter,O=s.Transforms.eastNorthUpToFixedFrame(Y,_),B=t.Matrix4.inverseTransformation(O,new t.Matrix4);p&&(h=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k),u=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(H)-h));let R=g.subarray(0,T),L=g.subarray(T,2*T),j=g.subarray(2*T,3*T),U=i.defined(f),z=Array(T),q=Array(T),Q=Array(T),K=p?Array(T):[],X=v?Array(T):[],Z=b;Z.x=Number.POSITIVE_INFINITY,Z.y=Number.POSITIVE_INFINITY,Z.z=Number.POSITIVE_INFINITY;let J=w;J.x=Number.NEGATIVE_INFINITY,J.y=Number.NEGATIVE_INFINITY,J.z=Number.NEGATIVE_INFINITY;let $=Number.POSITIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,et=Number.POSITIVE_INFINITY,er=Number.NEGATIVE_INFINITY;for(let e=0;e<T;++e){let i=R[e],n=L[e],o=i/32767,s=n/32767,d=a.CesiumMath.lerp(G,V,j[e]/32767);S.longitude=a.CesiumMath.lerp(D,F,o),S.latitude=a.CesiumMath.lerp(k,H,s),S.height=d,$=Math.min(S.longitude,$),ee=Math.max(S.longitude,ee),et=Math.min(S.latitude,et),er=Math.max(S.latitude,er);let c=_.cartographicToCartesian(S);z[e]=new t.Cartesian2(o,s),q[e]=d,Q[e]=c,p&&(K[e]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-h)*u),v&&(X[e]=_.geodeticSurfaceNormal(c)),t.Matrix4.multiplyByPoint(B,c,M),r.Cartesian3.minimumByComponent(M,Z,Z),r.Cartesian3.maximumByComponent(M,J,J)}let ei=W(d.westIndices,function(e,t){return z[e].y-z[t].y}),en=W(d.eastIndices,function(e,t){return z[t].y-z[e].y}),eo=W(d.southIndices,function(e,t){return z[t].x-z[e].x}),ea=W(d.northIndices,function(e,t){return z[e].x-z[t].x});G<0&&(I=new n.EllipsoidalOccluder(_).computeHorizonCullingPointPossiblyUnderEllipsoid(Y,Q,G));let es=G;es=Math.min(es=Math.min(es=Math.min(es=Math.min(es,A(d.westIndices,d.westSkirtHeight,q,z,P,_,B,Z,J)),A(d.southIndices,d.southSkirtHeight,q,z,P,_,B,Z,J)),A(d.eastIndices,d.eastSkirtHeight,q,z,P,_,B,Z,J)),A(d.northIndices,d.northSkirtHeight,q,z,P,_,B,Z,J));let el=new e.AxisAlignedBoundingBox(Z,J,Y),ed=new n.TerrainEncoding(Y,el,es,V,O,U,p,v,y,N),ec=ed.stride,eh=new Float32Array(T*ec+E*ec),eu=0;for(let e=0;e<T;++e){if(U){let t=2*e;x.x=f[t],x.y=f[t+1]}eu=ed.encode(eh,eu,Q[e],z[e],q[e],x,K[e],X[e])}let eI=d.indices.length+3*Math.max(0,2*(E-4)),eg=o.IndexDatatype.createTypedArray(T+E,eI);eg.set(d.indices,0);let em=(ee-$)*1e-4,eT=(er-et)*1e-4,ef=T*ec;return C(eh,ef,ei,ed,q,z,f,_,P,d.westSkirtHeight,h,u,-em,0),C(eh,ef+=d.westIndices.length*ec,eo,ed,q,z,f,_,P,d.southSkirtHeight,h,u,0,-eT),C(eh,ef+=d.southIndices.length*ec,en,ed,q,z,f,_,P,d.eastSkirtHeight,h,u,em,0),C(eh,ef+=d.eastIndices.length*ec,ea,ed,q,z,f,_,P,d.northSkirtHeight,h,u,0,eT),m.addSkirtIndices(ei,eo,en,ea,T,eg,d.indices.length),c.push(eh.buffer,eg.buffer),{vertices:eh.buffer,indices:eg.buffer,westIndicesSouthToNorth:ei,southIndicesEastToWest:eo,eastIndicesNorthToSouth:en,northIndicesWestToEast:ea,vertexStride:ec,center:Y,minimumHeight:G,maximumHeight:V,occludeePointInScaledSpace:I,encoding:ed,indexCountWithoutSkirts:d.indices.length}})});