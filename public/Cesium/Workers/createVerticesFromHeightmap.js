define(["./Matrix3-81054f0f","./AxisAlignedBoundingBox-39ab50d0","./Transforms-fce95115","./Matrix2-413c4048","./defaultValue-f6d5e6da","./TerrainEncoding-bd5c9ed5","./Math-2ce22ee9","./OrientedBoundingBox-cfd17917","./WebMercatorProjection-943e2226","./RuntimeError-9b4ce3fb","./createTaskProcessorWorker","./combine-0c102d93","./AttributeCompression-48e336db","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./EllipsoidTangentPlane-82f2a887","./IntersectionTests-357c3d7f","./Plane-6add0ae1"],function(t,i,a,r,n,s,l,o,f,u,c,d,h,m,g,p,x,w){"use strict";var k=Object.freeze({NONE:0,LERC:1});let y={};y.DEFAULT_STRUCTURE=Object.freeze({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});let I=new t.Cartesian3,b=new r.Matrix4,U=new t.Cartesian3,M=new t.Cartesian3;y.computeVertices=function(u){let c,d,h,m,g,p,x,w;let k=Math.cos,T=Math.sin,V=Math.sqrt,v=Math.atan,A=Math.exp,B=l.CesiumMath.PI_OVER_TWO,D=l.CesiumMath.toRadians,S=u.heightmap,P=u.width,E=u.height,C=u.skirtHeight,F=n.defaultValue(u.isGeographic,!0),N=n.defaultValue(u.ellipsoid,t.Ellipsoid.WGS84),O=1/N.maximumRadius,R=r.Rectangle.clone(u.nativeRectangle),L=r.Rectangle.clone(u.rectangle);n.defined(L)?(c=L.west,d=L.south,h=L.east,m=L.north):F?(c=D(R.west),d=D(R.south),h=D(R.east),m=D(R.north)):(c=R.west*O,d=B-2*v(A(-R.south*O)),h=R.east*O,m=B-2*v(A(-R.north*O)));let z=u.relativeToCenter,H=n.defined(z);z=H?z:t.Cartesian3.ZERO;let _=n.defaultValue(u.includeWebMercatorT,!1),Y=n.defaultValue(u.exaggeration,1),W=n.defaultValue(u.exaggerationRelativeHeight,0),X=1!==Y,Z=n.defaultValue(u.structure,y.DEFAULT_STRUCTURE),j=n.defaultValue(Z.heightScale,y.DEFAULT_STRUCTURE.heightScale),G=n.defaultValue(Z.heightOffset,y.DEFAULT_STRUCTURE.heightOffset),q=n.defaultValue(Z.elementsPerHeight,y.DEFAULT_STRUCTURE.elementsPerHeight),Q=n.defaultValue(Z.stride,y.DEFAULT_STRUCTURE.stride),J=n.defaultValue(Z.elementMultiplier,y.DEFAULT_STRUCTURE.elementMultiplier),K=n.defaultValue(Z.isBigEndian,y.DEFAULT_STRUCTURE.isBigEndian),$=r.Rectangle.computeWidth(R),ee=r.Rectangle.computeHeight(R),et=$/(P-1),ei=ee/(E-1);F||($*=O,ee*=O);let ea=N.radiiSquared,er=ea.x,en=ea.y,es=ea.z,el=65536,eo=-65536,ef=a.Transforms.eastNorthUpToFixedFrame(z,N),eu=r.Matrix4.inverseTransformation(ef,b);_&&(g=f.WebMercatorProjection.geodeticLatitudeToMercatorAngle(d),p=1/(f.WebMercatorProjection.geodeticLatitudeToMercatorAngle(m)-g));let ec=U;ec.x=Number.POSITIVE_INFINITY,ec.y=Number.POSITIVE_INFINITY,ec.z=Number.POSITIVE_INFINITY;let ed=M;ed.x=Number.NEGATIVE_INFINITY,ed.y=Number.NEGATIVE_INFINITY,ed.z=Number.NEGATIVE_INFINITY;let eh=Number.POSITIVE_INFINITY,em=P*E,eg=em+(C>0?2*P+2*E:0),ep=Array(eg),ex=Array(eg),ew=Array(eg),ek=_?Array(eg):[],ey=X?Array(eg):[],eI=0,eb=E,eU=0,eM=P;C>0&&(--eI,++eb,--eU,++eM);for(let i=eI;i<eb;++i){let a,n=i;n<0&&(n=0),n>=E&&(n=E-1);let s=R.north-ei*n,o=((s=F?D(s):B-2*v(A(-s*O)))-d)/(m-d);o=l.CesiumMath.clamp(o,0,1);let u=i===eI,x=i===eb-1;C>0&&(u?s+=1e-5*ee:x&&(s-=1e-5*ee));let w=k(s),y=T(s),b=es*y;_&&(a=(f.WebMercatorProjection.geodeticLatitudeToMercatorAngle(s)-g)*p);for(let i=eU;i<eM;++i){let s,f=i;f<0&&(f=0),f>=P&&(f=P-1);let d=n*(P*Q)+f*Q;if(1===q)s=S[d];else{let t;if(s=0,K)for(t=0;t<q;++t)s=s*J+S[d+t];else for(t=q-1;t>=0;--t)s=s*J+S[d+t]}eo=Math.max(eo,s=s*j+G),el=Math.min(el,s);let m=R.west+et*f;F?m=D(m):m*=O;let g=(m-c)/(h-c);g=l.CesiumMath.clamp(g,0,1);let p=n*P+f;if(C>0){let t=i===eU,a=i===eM-1,r=u||x||t||a;if((u||x)&&(t||a))continue;r&&(s-=C,t?(p=em+(E-n-1),m-=1e-5*$):x?p=em+E+(P-f-1):a?(p=em+E+P+n,m+=1e-5*$):u&&(p=em+E+P+E+f))}let U=w*k(m),M=w*T(m),v=er*U,A=en*M,B=1/V(v*U+A*M+b*y),L=v*B,z=A*B,H=b*B,Y=new t.Cartesian3;Y.x=L+U*s,Y.y=z+M*s,Y.z=H+y*s,r.Matrix4.multiplyByPoint(eu,Y,I),t.Cartesian3.minimumByComponent(I,ec,ec),t.Cartesian3.maximumByComponent(I,ed,ed),eh=Math.min(eh,s),ep[p]=Y,ew[p]=new r.Cartesian2(g,o),ex[p]=s,_&&(ek[p]=a),X&&(ey[p]=N.geodeticSurfaceNormal(Y))}}let eT=a.BoundingSphere.fromPoints(ep);n.defined(L)&&(x=o.OrientedBoundingBox.fromRectangle(L,el,eo,N)),H&&(w=new s.EllipsoidalOccluder(N).computeHorizonCullingPointPossiblyUnderEllipsoid(z,ep,el));let eV=new i.AxisAlignedBoundingBox(ec,ed,z),ev=new s.TerrainEncoding(z,eV,eh,eo,ef,!1,_,X,Y,W),eA=new Float32Array(eg*ev.stride),eB=0;for(let t=0;t<eg;++t)eB=ev.encode(eA,eB,ep[t],ew[t],ex[t],void 0,ek[t],ey[t]);return{vertices:eA,maximumHeight:eo,minimumHeight:el,encoding:ev,boundingSphere3D:eT,orientedBoundingBox:x,occludeePointInScaledSpace:w}};var T,V={};T={get exports(){return V},set exports(e){V=e}},function(){var t,i,a,r,n,s,l,o,f,u,c,d,h,m,g,p,x=(t={defaultNoDataValue:-34027999387901484e22,decode:function(s,l){var o=(l=l||{}).encodedMaskData||null===l.encodedMaskData,f=n(s,l.inputOffset||0,o),u=null!==l.noDataValue?l.noDataValue:t.defaultNoDataValue,c=i(f,l.pixelType||Float32Array,l.encodedMaskData,u,l.returnMask),d={width:f.width,height:f.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:f.pixels.maxValue,noDataValue:u};return c.resultMask&&(d.maskData=c.resultMask),l.returnEncodedMask&&f.mask&&(d.encodedMaskData=f.mask.bitset?f.mask.bitset:null),l.returnFileInfo&&(d.fileInfo=a(f),l.computeUsedBitDepths&&(d.fileInfo.bitDepths=r(f))),d}},i=function(t,i,a,r,n){var l,o,f,u=0,c=t.pixels.numBlocksX,d=t.pixels.numBlocksY,h=Math.floor(t.width/c),m=Math.floor(t.height/d),g=2*t.maxZError,p=Number.MAX_VALUE;a=a||(t.mask?t.mask.bitset:null),o=new i(t.width*t.height),n&&a&&(f=new Uint8Array(t.width*t.height));for(var x,w,k=new Float32Array(h*m),y=0;y<=d;y++){var I=y!==d?m:t.height%d;if(0!==I)for(var b=0;b<=c;b++){var U=b!==c?h:t.width%c;if(0!==U){var M,T,V,v,A=y*t.width*m+b*h,B=t.width-U,D=t.pixels.blocks[u];if(D.encoding<2?(0===D.encoding?M=D.rawData:(s(D.stuffedData,D.bitsPerPixel,D.numValidPixels,D.offset,g,k,t.pixels.maxValue),M=k),T=0):V=2===D.encoding?0:D.offset,a)for(w=0;w<I;w++){for(7&A&&(v=a[A>>3]<<(7&A)),x=0;x<U;x++)7&A||(v=a[A>>3]),128&v?(f&&(f[A]=1),p=p>(l=D.encoding<2?M[T++]:V)?l:p,o[A++]=l):(f&&(f[A]=0),o[A++]=r),v<<=1;A+=B}else if(D.encoding<2)for(w=0;w<I;w++){for(x=0;x<U;x++)p=p>(l=M[T++])?l:p,o[A++]=l;A+=B}else for(p=p>V?V:p,w=0;w<I;w++){for(x=0;x<U;x++)o[A++]=V;A+=B}if(1===D.encoding&&T!==D.numValidPixels)throw"Block and Mask do not match";u++}}}return{resultPixels:o,resultMask:f,minValue:p}},a=function(t){return{fileIdentifierString:t.fileIdentifierString,fileVersion:t.fileVersion,imageType:t.imageType,height:t.height,width:t.width,maxZError:t.maxZError,eofOffset:t.eofOffset,mask:t.mask?{numBlocksX:t.mask.numBlocksX,numBlocksY:t.mask.numBlocksY,numBytes:t.mask.numBytes,maxValue:t.mask.maxValue}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,numBytes:t.pixels.numBytes,maxValue:t.pixels.maxValue,noDataValue:t.noDataValue}}},r=function(t){for(var i=t.pixels.numBlocksX*t.pixels.numBlocksY,a={},r=0;r<i;r++){var n=t.pixels.blocks[r];0===n.encoding?a.float32=!0:1===n.encoding?a[n.bitsPerPixel]=!0:a[0]=!0}return Object.keys(a)},n=function(t,i,a){var r={},n=new Uint8Array(t,i,10);if(r.fileIdentifierString=String.fromCharCode.apply(null,n),"CntZImage"!==r.fileIdentifierString.trim())throw"Unexpected file identifier string: "+r.fileIdentifierString;i+=10;var s=new DataView(t,i,24);if(r.fileVersion=s.getInt32(0,!0),r.imageType=s.getInt32(4,!0),r.height=s.getUint32(8,!0),r.width=s.getUint32(12,!0),r.maxZError=s.getFloat64(16,!0),i+=24,!a){if(s=new DataView(t,i,16),r.mask={},r.mask.numBlocksY=s.getUint32(0,!0),r.mask.numBlocksX=s.getUint32(4,!0),r.mask.numBytes=s.getUint32(8,!0),r.mask.maxValue=s.getFloat32(12,!0),i+=16,r.mask.numBytes>0){var l=new Uint8Array(Math.ceil(r.width*r.height/8)),o=(s=new DataView(t,i,r.mask.numBytes)).getInt16(0,!0),f=2,u=0;do{if(o>0)for(;o--;)l[u++]=s.getUint8(f++);else{var c=s.getUint8(f++);for(o=-o;o--;)l[u++]=c}o=s.getInt16(f,!0),f+=2}while(f<r.mask.numBytes);if(-32768!==o||u<l.length)throw"Unexpected end of mask RLE encoding";r.mask.bitset=l,i+=r.mask.numBytes}else 0==(r.mask.numBytes|r.mask.numBlocksY|r.mask.maxValue)&&(r.mask.bitset=new Uint8Array(Math.ceil(r.width*r.height/8)))}s=new DataView(t,i,16),r.pixels={},r.pixels.numBlocksY=s.getUint32(0,!0),r.pixels.numBlocksX=s.getUint32(4,!0),r.pixels.numBytes=s.getUint32(8,!0),r.pixels.maxValue=s.getFloat32(12,!0),i+=16;var d=r.pixels.numBlocksX,h=r.pixels.numBlocksY,m=d+(r.width%d>0?1:0),g=h+(r.height%h>0?1:0);r.pixels.blocks=Array(m*g);for(var p=0,x=0;x<g;x++)for(var w=0;w<m;w++){var k=0,y=t.byteLength-i;s=new DataView(t,i,Math.min(10,y));var I={};r.pixels.blocks[p++]=I;var b=s.getUint8(0);if(k++,I.encoding=63&b,I.encoding>3)throw"Invalid block encoding ("+I.encoding+")";if(2!==I.encoding){if(0!==b&&2!==b){if(b>>=6,I.offsetType=b,2===b)I.offset=s.getInt8(1),k++;else if(1===b)I.offset=s.getInt16(1,!0),k+=2;else{if(0!==b)throw"Invalid block offset type";I.offset=s.getFloat32(1,!0),k+=4}if(1===I.encoding){if(b=s.getUint8(k),k++,I.bitsPerPixel=63&b,b>>=6,I.numValidPixelsType=b,2===b)I.numValidPixels=s.getUint8(k),k++;else if(1===b)I.numValidPixels=s.getUint16(k,!0),k+=2;else{if(0!==b)throw"Invalid valid pixel count type";I.numValidPixels=s.getUint32(k,!0),k+=4}}}if(i+=k,3!==I.encoding){if(0===I.encoding){var U,M=(r.pixels.numBytes-1)/4;if(M!==Math.floor(M))throw"uncompressed block has invalid length";U=new ArrayBuffer(4*M),new Uint8Array(U).set(new Uint8Array(t,i,4*M));var T=new Float32Array(U);I.rawData=T,i+=4*M}else if(1===I.encoding){var V=Math.ceil(I.numValidPixels*I.bitsPerPixel/8),v=Math.ceil(V/4);U=new ArrayBuffer(4*v),new Uint8Array(U).set(new Uint8Array(t,i,V)),I.stuffedData=new Uint32Array(U),i+=V}}}else i++}return r.eofOffset=i,r},s=function(t,i,a,r,n,s,l){var o,f,u,c=(1<<i)-1,d=0,h=0,m=Math.ceil((l-r)/n),g=4*t.length-Math.ceil(i*a/8);for(t[t.length-1]<<=8*g,o=0;o<a;o++){if(0===h&&(u=t[d++],h=32),h>=i)f=u>>>h-i&c,h-=i;else{var p=i-h;f=((u&c)<<p&c)+((u=t[d++])>>>(h=32-p))}s[o]=f<m?r+f*n:l}return s},t),w=(l=function(t,i,a,r,n,s,l,o){var f,u,c,d,h,m=(1<<a)-1,g=0,p=0,x=4*t.length-Math.ceil(a*r/8);if(t[t.length-1]<<=8*x,n)for(f=0;f<r;f++)0===p&&(c=t[g++],p=32),p>=a?(u=c>>>p-a&m,p-=a):u=((c&m)<<(d=a-p)&m)+((c=t[g++])>>>(p=32-d)),i[f]=n[u];else for(h=Math.ceil((o-s)/l),f=0;f<r;f++)0===p&&(c=t[g++],p=32),p>=a?(u=c>>>p-a&m,p-=a):u=((c&m)<<(d=a-p)&m)+((c=t[g++])>>>(p=32-d)),i[f]=u<h?s+u*l:o},o=function(t,i,a,r,n,s){var l,o=(1<<i)-1,f=0,u=0,c=0,d=0,h=0,m=[],g=4*t.length-Math.ceil(i*a/8);t[t.length-1]<<=8*g;var p=Math.ceil((s-r)/n);for(u=0;u<a;u++)0===d&&(l=t[f++],d=32),d>=i?(h=l>>>d-i&o,d-=i):h=((l&o)<<(c=i-d)&o)+((l=t[f++])>>>(d=32-c)),m[u]=h<p?r+h*n:s;return m.unshift(r),m},f=function(t,i,a,r,n,s,l,o){var f,u,c,d,h=(1<<a)-1,m=0,g=0,p=0;if(n)for(f=0;f<r;f++)0===g&&(c=t[m++],g=32,p=0),g>=a?(u=c>>>p&h,g-=a,p+=a):(u=c>>>p&h,g=32-(d=a-g),u|=((c=t[m++])&(1<<d)-1)<<a-d,p=d),i[f]=n[u];else{var x=Math.ceil((o-s)/l);for(f=0;f<r;f++)0===g&&(c=t[m++],g=32,p=0),g>=a?(u=c>>>p&h,g-=a,p+=a):(u=c>>>p&h,g=32-(d=a-g),u|=((c=t[m++])&(1<<d)-1)<<a-d,p=d),i[f]=u<x?s+u*l:o}return i},u=function(t,i,a,r,n,s){var l,o=(1<<i)-1,f=0,u=0,c=0,d=0,h=0,m=0,g=[],p=Math.ceil((s-r)/n);for(u=0;u<a;u++)0===d&&(l=t[f++],d=32,m=0),d>=i?(h=l>>>m&o,d-=i,m+=i):(h=l>>>m&o,d=32-(c=i-d),h|=((l=t[f++])&(1<<c)-1)<<i-c,m=c),g[u]=h<p?r+h*n:s;return g.unshift(r),g},c=function(t,i,a,r){var n,s,l,o,f=(1<<a)-1,u=0,c=0,d=4*t.length-Math.ceil(a*r/8);for(t[t.length-1]<<=8*d,n=0;n<r;n++)0===c&&(l=t[u++],c=32),c>=a?(s=l>>>c-a&f,c-=a):s=((l&f)<<(o=a-c)&f)+((l=t[u++])>>>(c=32-o)),i[n]=s;return i},d=function(t,i,a,r){var n,s,l,o,f=(1<<a)-1,u=0,c=0,d=0;for(n=0;n<r;n++)0===c&&(l=t[u++],c=32,d=0),c>=a?(s=l>>>d&f,c-=a,d+=a):(s=l>>>d&f,c=32-(o=a-c),s|=((l=t[u++])&(1<<o)-1)<<a-o,d=o),i[n]=s;return i},h={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(t){for(var i=65535,a=65535,r=t.length,n=Math.floor(r/2),s=0;n;){var l=n>=359?359:n;n-=l;do i+=t[s++]<<8,a+=i+=t[s++];while(--l);i=(65535&i)+(i>>>16),a=(65535&a)+(a>>>16)}return 1&r&&(a+=i+=t[s]<<8),((a=(65535&a)+(a>>>16))<<16|(i=(65535&i)+(i>>>16)))>>>0},readHeaderInfo:function(t,i){var a=i.ptr,r=new Uint8Array(t,a,6),n={};if(n.fileIdentifierString=String.fromCharCode.apply(null,r),0!==n.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+n.fileIdentifierString;a+=6;var s=new DataView(t,a,8),l=s.getInt32(0,!0);if(n.fileVersion=l,a+=4,l>=3&&(n.checksum=s.getUint32(4,!0),a+=4),s=new DataView(t,a,12),n.height=s.getUint32(0,!0),n.width=s.getUint32(4,!0),a+=8,l>=4?(n.numDims=s.getUint32(8,!0),a+=4):n.numDims=1,s=new DataView(t,a,40),n.numValidPixel=s.getUint32(0,!0),n.microBlockSize=s.getInt32(4,!0),n.blobSize=s.getInt32(8,!0),n.imageType=s.getInt32(12,!0),n.maxZError=s.getFloat64(16,!0),n.zMin=s.getFloat64(24,!0),n.zMax=s.getFloat64(32,!0),a+=40,i.headerInfo=n,i.ptr=a,l>=3&&this.computeChecksumFletcher32(new Uint8Array(t,a-(l>=4?52:48),n.blobSize-14))!==n.checksum)throw"Checksum failed.";return!0},checkMinMaxRanges:function(t,i){var a=i.headerInfo,r=this.getDataTypeArray(a.imageType),n=a.numDims*this.getDataTypeSize(a.imageType),s=this.readSubArray(t,i.ptr,r,n),l=this.readSubArray(t,i.ptr+n,r,n);i.ptr+=2*n;var o,f=!0;for(o=0;o<a.numDims;o++)if(s[o]!==l[o]){f=!1;break}return a.minValues=s,a.maxValues=l,f},readSubArray:function(t,i,a,r){var n;if(a===Uint8Array)n=new Uint8Array(t,i,r);else{var s=new ArrayBuffer(r);new Uint8Array(s).set(new Uint8Array(t,i,r)),n=new a(s)}return n},readMask:function(t,i){var a,r,n=i.ptr,s=i.headerInfo,l=s.width*s.height,o=s.numValidPixel,f=new DataView(t,n,4),u={};if(u.numBytes=f.getUint32(0,!0),n+=4,(0===o||l===o)&&0!==u.numBytes)throw"invalid mask";if(0===o)a=new Uint8Array(Math.ceil(l/8)),u.bitset=a,r=new Uint8Array(l),i.pixels.resultMask=r,n+=u.numBytes;else if(u.numBytes>0){a=new Uint8Array(Math.ceil(l/8));var c=(f=new DataView(t,n,u.numBytes)).getInt16(0,!0),d=2,h=0,m=0;do{if(c>0)for(;c--;)a[h++]=f.getUint8(d++);else for(m=f.getUint8(d++),c=-c;c--;)a[h++]=m;c=f.getInt16(d,!0),d+=2}while(d<u.numBytes);if(-32768!==c||h<a.length)throw"Unexpected end of mask RLE encoding";r=new Uint8Array(l);var g=0;for(g=0;g<l;g++)128&(7&g?a[g>>3]<<(7&g):a[g>>3])&&(r[g]=1);i.pixels.resultMask=r,u.bitset=a,n+=u.numBytes}return i.ptr=n,i.mask=u,!0},readDataOneSweep:function(t,i,a){var r,n=i.ptr,s=i.headerInfo,l=s.numDims,o=s.width*s.height,f=s.imageType,u=s.numValidPixel*h.getDataTypeSize(f)*l,c=i.pixels.resultMask;if(a===Uint8Array)r=new Uint8Array(t,n,u);else{var d=new ArrayBuffer(u);new Uint8Array(d).set(new Uint8Array(t,n,u)),r=new a(d)}if(r.length===o*l)i.pixels.resultPixels=r;else{i.pixels.resultPixels=new a(o*l);var m=0,g=0,p=0,x=0;if(l>1)for(p=0;p<l;p++)for(x=p*o,g=0;g<o;g++)c[g]&&(i.pixels.resultPixels[x+g]=r[m++]);else for(g=0;g<o;g++)c[g]&&(i.pixels.resultPixels[g]=r[m++])}return n+=u,i.ptr=n,!0},readHuffmanTree:function(t,i){var a=this.HUFFMAN_LUT_BITS_MAX,r=new DataView(t,i.ptr,16);if(i.ptr+=16,2>r.getInt32(0,!0))throw"unsupported Huffman version";var n=r.getInt32(4,!0),s=r.getInt32(8,!0),l=r.getInt32(12,!0);if(s>=l)return!1;var o=new Uint32Array(l-s);h.decodeBits(t,i,o);var f,u,c,d,g=[];for(f=s;f<l;f++)g[u=f-(f<n?0:n)]={first:o[f-s],second:null};var p=t.byteLength-i.ptr,x=new ArrayBuffer(4*Math.ceil(p/4));new Uint8Array(x).set(new Uint8Array(t,i.ptr,p));var w,k=new Uint32Array(x),y=0,I=0;for(w=k[0],f=s;f<l;f++)(d=g[u=f-(f<n?0:n)].first)>0&&(g[u].second=w<<y>>>32-d,32-y>=d?32===(y+=d)&&(y=0,w=k[++I]):(y+=d-32,w=k[++I],g[u].second|=w>>>32-y));var b=0,U=0,M=new m;for(f=0;f<g.length;f++)void 0!==g[f]&&(b=Math.max(b,g[f].first));U=b>=a?a:b,b>=30&&console.log("WARning, large NUM LUT BITS IS "+b);var T,V,v,A,B,D=[];for(f=s;f<l;f++)if((d=g[u=f-(f<n?0:n)].first)>0){if(T=[d,u],d<=U)for(V=g[u].second<<U-d,v=1<<U-d,c=0;c<v;c++)D[V|c]=T;else for(V=g[u].second,B=M,A=d-1;A>=0;A--)V>>>A&1?(B.right||(B.right=new m),B=B.right):(B.left||(B.left=new m),B=B.left),0!==A||B.val||(B.val=T[1])}return{decodeLut:D,numBitsLUTQick:U,numBitsLUT:b,tree:M,stuffedData:k,srcPtr:I,bitPos:y}},readHuffman:function(t,i,a){var r,n,s,l,o,f,u,c,d,h=i.headerInfo,m=h.numDims,g=i.headerInfo.height,p=i.headerInfo.width,x=p*g,w=this.readHuffmanTree(t,i),k=w.decodeLut,y=w.tree,I=w.stuffedData,b=w.srcPtr,U=w.bitPos,M=w.numBitsLUTQick,T=w.numBitsLUT,V=0===i.headerInfo.imageType?128:0,v=i.pixels.resultMask,A=0;U>0&&(b++,U=0);var B,D=I[b],S=1===i.encodeMode,P=new a(x*m),E=P;for(B=0;B<h.numDims;B++){if(m>1&&(E=new a(P.buffer,x*B,x),A=0),i.headerInfo.numValidPixel===p*g)for(c=0,f=0;f<g;f++)for(u=0;u<p;u++,c++){if(n=0,o=l=D<<U>>>32-M,32-U<M&&(o=l|=I[b+1]>>>64-U-M),k[o])n=k[o][1],U+=k[o][0];else for(o=l=D<<U>>>32-T,32-U<T&&(o=l|=I[b+1]>>>64-U-T),r=y,d=0;d<T;d++)if(!(r=l>>>T-d-1&1?r.right:r.left).left&&!r.right){n=r.val,U=U+d+1;break}U>=32&&(U-=32,D=I[++b]),s=n-V,S?(s+=u>0?A:f>0?E[c-p]:A,s&=255,E[c]=s,A=s):E[c]=s}else for(c=0,f=0;f<g;f++)for(u=0;u<p;u++,c++)if(v[c]){if(n=0,o=l=D<<U>>>32-M,32-U<M&&(o=l|=I[b+1]>>>64-U-M),k[o])n=k[o][1],U+=k[o][0];else for(o=l=D<<U>>>32-T,32-U<T&&(o=l|=I[b+1]>>>64-U-T),r=y,d=0;d<T;d++)if(!(r=l>>>T-d-1&1?r.right:r.left).left&&!r.right){n=r.val,U=U+d+1;break}U>=32&&(U-=32,D=I[++b]),s=n-V,S?(u>0&&v[c-1]?s+=A:f>0&&v[c-p]?s+=E[c-p]:s+=A,s&=255,E[c]=s,A=s):E[c]=s}i.ptr=i.ptr+4*(b+1)+(U>0?4:0)}i.pixels.resultPixels=P},decodeBits:function(t,i,a,r,n){var s=i.headerInfo,h=s.fileVersion,m=0,g=new DataView(t,i.ptr,5),p=g.getUint8(0);m++;var x=p>>6,w=0===x?4:3-x,k=31&p,y=0;if(1===w)y=g.getUint8(m),m++;else if(2===w)y=g.getUint16(m,!0),m+=2;else{if(4!==w)throw"Invalid valid pixel count type";y=g.getUint32(m,!0),m+=4}var I,b,U,M,T,V,v,A,B,D=2*s.maxZError,S=s.numDims>1?s.maxValues[n]:s.zMax;if((32&p)>0){for(i.counter.lut++,A=g.getUint8(m),m++,T=Math.ceil((M=Math.ceil((A-1)*k/8))/4),b=new ArrayBuffer(4*T),U=new Uint8Array(b),i.ptr+=m,U.set(new Uint8Array(t,i.ptr,M)),v=new Uint32Array(b),i.ptr+=M,B=0;A-1>>>B;)B++;T=Math.ceil((M=Math.ceil(y*B/8))/4),b=new ArrayBuffer(4*T),(U=new Uint8Array(b)).set(new Uint8Array(t,i.ptr,M)),I=new Uint32Array(b),i.ptr+=M,V=h>=3?u(v,k,A-1,r,D,S):o(v,k,A-1,r,D,S),h>=3?f(I,a,B,y,V):l(I,a,B,y,V)}else i.counter.bitstuffer++,B=k,i.ptr+=m,B>0&&(T=Math.ceil((M=Math.ceil(y*B/8))/4),b=new ArrayBuffer(4*T),(U=new Uint8Array(b)).set(new Uint8Array(t,i.ptr,M)),I=new Uint32Array(b),i.ptr+=M,h>=3?null==r?d(I,a,B,y):f(I,a,B,y,!1,r,D,S):null==r?c(I,a,B,y):l(I,a,B,y,!1,r,D,S))},readTiles:function(t,i,a){var r=i.headerInfo,n=r.width,s=r.height,l=r.microBlockSize,o=r.imageType,f=h.getDataTypeSize(o),u=Math.ceil(n/l),c=Math.ceil(s/l);i.pixels.numBlocksY=c,i.pixels.numBlocksX=u,i.pixels.ptr=0;var d,m,g,p,x,w,k,y,I=0,b=0,U=0,M=0,T=0,V=0,v=0,A=0,B=0,D=0,S=0,P=0,E=0,C=0,F=0,N=new a(l*l),O=s%l||l,R=n%l||l,L=r.numDims,z=i.pixels.resultMask,H=i.pixels.resultPixels;for(U=0;U<c;U++)for(T=U!==c-1?l:O,M=0;M<u;M++)for(D=U*n*l+M*l,S=n-(V=M!==u-1?l:R),y=0;y<L;y++){if(L>1&&(H=new a(i.pixels.resultPixels.buffer,n*s*y*f,n*s)),v=t.byteLength-i.ptr,m={},F=0,F++,B=(A=(d=new DataView(t,i.ptr,Math.min(10,v))).getUint8(0))>>6&255,(A>>2&15)!=(M*l>>3&15))throw"integrity issue";if((x=3&A)>3)throw i.ptr+=F,"Invalid block encoding ("+x+")";if(2!==x){if(0===x){if(i.counter.uncompressed++,i.ptr+=F,P=(P=T*V*f)<(E=t.byteLength-i.ptr)?P:E,g=new ArrayBuffer(P%f==0?P:P+f-P%f),new Uint8Array(g).set(new Uint8Array(t,i.ptr,P)),p=new a(g),C=0,z)for(I=0;I<T;I++){for(b=0;b<V;b++)z[D]&&(H[D]=p[C++]),D++;D+=S}else for(I=0;I<T;I++){for(b=0;b<V;b++)H[D++]=p[C++];D+=S}i.ptr+=C*f}else if(w=h.getDataTypeUsed(o,B),k=h.getOnePixel(m,F,w,d),F+=h.getDataTypeSize(w),3===x){if(i.ptr+=F,i.counter.constantoffset++,z)for(I=0;I<T;I++){for(b=0;b<V;b++)z[D]&&(H[D]=k),D++;D+=S}else for(I=0;I<T;I++){for(b=0;b<V;b++)H[D++]=k;D+=S}}else if(i.ptr+=F,h.decodeBits(t,i,N,k,y),F=0,z)for(I=0;I<T;I++){for(b=0;b<V;b++)z[D]&&(H[D]=N[F++]),D++;D+=S}else for(I=0;I<T;I++){for(b=0;b<V;b++)H[D++]=N[F++];D+=S}}else i.counter.constant++,i.ptr+=F}},formatFileInfo:function(t){return{fileIdentifierString:t.headerInfo.fileIdentifierString,fileVersion:t.headerInfo.fileVersion,imageType:t.headerInfo.imageType,height:t.headerInfo.height,width:t.headerInfo.width,numValidPixel:t.headerInfo.numValidPixel,microBlockSize:t.headerInfo.microBlockSize,blobSize:t.headerInfo.blobSize,maxZError:t.headerInfo.maxZError,pixelType:h.getPixelType(t.headerInfo.imageType),eofOffset:t.eofOffset,mask:t.mask?{numBytes:t.mask.numBytes}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,maxValue:t.headerInfo.zMax,minValue:t.headerInfo.zMin,noDataValue:t.noDataValue}}},constructConstantSurface:function(t){var i=t.headerInfo.zMax,a=t.headerInfo.numDims,r=t.headerInfo.height*t.headerInfo.width,n=r*a,s=0,l=0,o=0,f=t.pixels.resultMask;if(f){if(a>1)for(s=0;s<a;s++)for(o=s*r,l=0;l<r;l++)f[l]&&(t.pixels.resultPixels[o+l]=i);else for(l=0;l<r;l++)f[l]&&(t.pixels.resultPixels[l]=i)}else if(t.pixels.resultPixels.fill)t.pixels.resultPixels.fill(i);else for(l=0;l<n;l++)t.pixels.resultPixels[l]=i},getDataTypeArray:function(t){var i;switch(t){case 0:i=Int8Array;break;case 1:i=Uint8Array;break;case 2:i=Int16Array;break;case 3:i=Uint16Array;break;case 4:i=Int32Array;break;case 5:i=Uint32Array;break;case 6:default:i=Float32Array;break;case 7:i=Float64Array}return i},getPixelType:function(t){var i;switch(t){case 0:i="S8";break;case 1:i="U8";break;case 2:i="S16";break;case 3:i="U16";break;case 4:i="S32";break;case 5:i="U32";break;case 6:default:i="F32";break;case 7:i="F64"}return i},isValidPixelValue:function(t,i){var a;if(null==i)return!1;switch(t){case 0:a=i>=-128&&i<=127;break;case 1:a=i>=0&&i<=255;break;case 2:a=i>=-32768&&i<=32767;break;case 3:a=i>=0&&i<=65536;break;case 4:a=i>=-2147483648&&i<=2147483647;break;case 5:a=i>=0&&i<=4294967296;break;case 6:a=i>=-34027999387901484e22&&i<=34027999387901484e22;break;case 7:a=i>=5e-324&&i<=17976931348623157e292;break;default:a=!1}return a},getDataTypeSize:function(t){var i=0;switch(t){case 0:case 1:i=1;break;case 2:case 3:i=2;break;case 4:case 5:case 6:i=4;break;case 7:i=8;break;default:i=t}return i},getDataTypeUsed:function(t,i){var a=t;switch(t){case 2:case 4:a=t-i;break;case 3:case 5:a=t-2*i;break;case 6:a=0===i?t:1===i?2:1;break;case 7:a=0===i?t:t-2*i+1;break;default:a=t}return a},getOnePixel:function(t,i,a,r){var n=0;switch(a){case 0:n=r.getInt8(i);break;case 1:n=r.getUint8(i);break;case 2:n=r.getInt16(i,!0);break;case 3:n=r.getUint16(i,!0);break;case 4:n=r.getInt32(i,!0);break;case 5:n=r.getUInt32(i,!0);break;case 6:n=r.getFloat32(i,!0);break;case 7:n=r.getFloat64(i,!0);break;default:throw"the decoder does not understand this pixel type"}return n}},m=function(t,i,a){this.val=t,this.left=i,this.right=a},{decode:function(t,i){var a=(i=i||{}).noDataValue,r=0,n={};if(n.ptr=i.inputOffset||0,n.pixels={},h.readHeaderInfo(t,n)){var s=n.headerInfo,l=s.fileVersion,o=h.getDataTypeArray(s.imageType);h.readMask(t,n),s.numValidPixel===s.width*s.height||n.pixels.resultMask||(n.pixels.resultMask=i.maskData);var f=s.width*s.height;if(n.pixels.resultPixels=new o(f*s.numDims),n.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0},0!==s.numValidPixel){if(s.zMax===s.zMin)h.constructConstantSurface(n);else if(l>=4&&h.checkMinMaxRanges(t,n))h.constructConstantSurface(n);else{var u=new DataView(t,n.ptr,2),c=u.getUint8(0);if(n.ptr++,c)h.readDataOneSweep(t,n,o);else if(l>1&&s.imageType<=1&&1e-5>Math.abs(s.maxZError-.5)){var d=u.getUint8(1);if(n.ptr++,n.encodeMode=d,d>2||l<4&&d>1)throw"Invalid Huffman flag "+d;d?h.readHuffman(t,n,o):h.readTiles(t,n,o)}else h.readTiles(t,n,o)}}n.eofOffset=n.ptr,i.inputOffset?Math.abs(n.headerInfo.blobSize+i.inputOffset-n.ptr)>=1&&(n.eofOffset=i.inputOffset+n.headerInfo.blobSize):Math.abs(n.headerInfo.blobSize-n.ptr)>=1&&(n.eofOffset=n.headerInfo.blobSize);var m={width:s.width,height:s.height,pixelData:n.pixels.resultPixels,minValue:s.zMin,maxValue:s.zMax,validPixelCount:s.numValidPixel,dimCount:s.numDims,dimStats:{minValues:s.minValues,maxValues:s.maxValues},maskData:n.pixels.resultMask};if(n.pixels.resultMask&&h.isValidPixelValue(s.imageType,a)){var g=n.pixels.resultMask;for(r=0;r<f;r++)g[r]||(m.pixelData[r]=a);m.noDataValue=a}return n.noDataValue=a,i.returnFileInfo&&(m.fileInfo=h.formatFileInfo(n)),m}},getBandCount:function(t){for(var i=0,a=0,r={ptr:0,pixels:{}};a<t.byteLength-58;)h.readHeaderInfo(t,r),a+=r.headerInfo.blobSize,i++,r.ptr=a;return i}}),k=(g=new ArrayBuffer(4),p=new Uint8Array(g),new Uint32Array(g)[0]=1,1===p[0]),y={decode:function(t,i){if(!k)throw"Big endian system is not supported.";var a,r,n=(i=i||{}).inputOffset||0,s=new Uint8Array(t,n,10),l=String.fromCharCode.apply(null,s);if("CntZImage"===l.trim())a=x,r=1;else{if("Lerc2"!==l.substring(0,5))throw"Unexpected file identifier string: "+l;a=w,r=2}for(var o,f,u,c,d,h,m=0,g=t.byteLength-10,p=[],y={width:0,height:0,pixels:[],pixelType:i.pixelType,mask:null,statistics:[]};n<g;){var I=a.decode(t,{inputOffset:n,encodedMaskData:o,maskData:u,returnMask:0===m,returnEncodedMask:0===m,returnFileInfo:!0,pixelType:i.pixelType||null,noDataValue:i.noDataValue||null});n=I.fileInfo.eofOffset,0===m&&(o=I.encodedMaskData,u=I.maskData,y.width=I.width,y.height=I.height,y.dimCount=I.dimCount||1,y.pixelType=I.pixelType||I.fileInfo.pixelType,y.mask=I.maskData),r>1&&I.fileInfo.mask&&I.fileInfo.mask.numBytes>0&&p.push(I.maskData),m++,y.pixels.push(I.pixelData),y.statistics.push({minValue:I.minValue,maxValue:I.maxValue,noDataValue:I.noDataValue,dimStats:I.dimStats})}if(r>1&&p.length>1){for(h=y.width*y.height,y.bandMasks=p,(u=new Uint8Array(h)).set(p[0]),c=1;c<p.length;c++)for(f=p[c],d=0;d<h;d++)u[d]=u[d]&f[d];y.maskData=u}return y}};T.exports?T.exports=y:this.Lerc=y}();var v=V;return c(function(i,a){if(i.encoding===k.LERC){let t;try{t=v.decode(i.heightmap)}catch(t){throw new u.RuntimeError(t)}if(t.statistics[0].minValue===Number.MAX_VALUE)throw new u.RuntimeError("Invalid tile data");i.heightmap=t.pixels[0],i.width=t.width,i.height=t.height}i.ellipsoid=t.Ellipsoid.clone(i.ellipsoid),i.rectangle=r.Rectangle.clone(i.rectangle);let n=y.computeVertices(i),s=n.vertices;return a.push(s.buffer),{vertices:s.buffer,numberOfAttributes:n.encoding.stride,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,gridWidth:i.width,gridHeight:i.height,boundingSphere3D:n.boundingSphere3D,orientedBoundingBox:n.orientedBoundingBox,occludeePointInScaledSpace:n.occludeePointInScaledSpace,encoding:n.encoding,westIndicesSouthToNorth:n.westIndicesSouthToNorth,southIndicesEastToWest:n.southIndicesEastToWest,eastIndicesNorthToSouth:n.eastIndicesNorthToSouth,northIndicesWestToEast:n.northIndicesWestToEast}})});