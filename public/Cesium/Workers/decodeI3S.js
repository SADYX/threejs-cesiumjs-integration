define(["./createTaskProcessorWorker","./defaultValue-f6d5e6da","./WebMercatorProjection-943e2226","./Matrix3-81054f0f","./Math-2ce22ee9"],function(e,t,n,r,o){"use strict";let a;function i(e,t,o){for(let a=0;a<o.length;a++){let i=o[a].nativeExtent,u=new r.Cartesian3;if("WebMercator"===o[a].projectionType){let i=o[a].projection._ellipsoid._radii;u=new n.WebMercatorProjection(new r.Ellipsoid(i.x,i.y,i.z)).project(new r.Cartographic(e,t,0))}else u.x=e,u.y=t;if(u.x>i.west&&u.x<i.east&&u.y>i.south&&u.y<i.north)return function(e,t,n){var r,o,a,i,u,s,l,f,c,d,y,h;let b=n.nativeExtent,p=(e-b.west)/(b.east-b.west)*(n.width-1),g=(t-b.south)/(b.north-b.south)*(n.height-1),m=Math.floor(p),A=Math.floor(g);p-=m,g-=A;let w=m<n.width?m+1:m,I=A<n.height?A+1:A;return A=n.height-1-A,I=n.height-1-I,c=p,d=g,r=A,o=n.width,y=n.buffer[m+r*o],a=A,i=n.width,h=n.buffer[w+a*i],u=I,s=n.width,((y*(1-c)+h*c)*(1-d)+(n.buffer[m+u*s]*(1-c)+(l=I,f=n.width,n.buffer[w+l*f]*c))*d)*n.scale+n.offset}(u.x,u.y,o[a])}return 0}let u={position:function(e,t,n){let r=3*e.vertexCount;return e.positions=new Float32Array(t,n,r),n+=4*r},normal:function(e,t,n){let r=3*e.vertexCount;return e.normals=new Float32Array(t,n,r),n+=4*r},uv0:function(e,t,n){let r=2*e.vertexCount;return e.uv0s=new Float32Array(t,n,r),n+=4*r},color:function(e,t,n){let r=4*e.vertexCount;return e.colors=new Uint8Array(t,n,r),n+=r},featureId:function(e,t,n){return n+8*e.featureCount},id:function(e,t,n){return n+8*e.featureCount},faceRange:function(e,t,n){let r=2*e.featureCount;return e.faceRange=new Uint32Array(t,n,r),n+=4*r},uvRegion:function(e,t,n){let r=4*e.vertexCount;return e["uv-region"]=new Uint16Array(t,n,r),n+=2*r},region:function(e,t,n){let r=4*e.vertexCount;return e["uv-region"]=new Uint16Array(t,n,r),n+=2*r}};function s(e){let n=function(e,n,r,o){let i=new Uint8Array(e,0,5);return i[0]==="D".charCodeAt()&&i[1]==="R".charCodeAt()&&i[2]==="A".charCodeAt()&&i[3]==="C".charCodeAt()&&i[4]==="O".charCodeAt()?function(e){let n,r;let o=a,i=new o.DecoderBuffer,u=new Uint8Array(e);i.Init(u,u.length);let s=new o.Decoder,l=s.GetEncodedGeometryType(i),f=new o.MetadataQuerier;l===o.TRIANGULAR_MESH&&(n=new o.Mesh,r=s.DecodeBufferToMesh(i,n));let c={vertexCount:[0],featureCount:0};if(t.defined(r)&&r.ok()&&0!==n.ptr){let e=n.num_faces(),r=n.num_attributes(),a=n.num_points();c.indices=new Uint32Array(3*e);let i=c.indices;c.vertexCount[0]=a,c.scale_x=1,c.scale_y=1;let u=new o.DracoInt32Array(3);for(let t=0;t<e;++t)s.GetFaceFromMesh(n,t,u),i[3*t]=u.GetValue(0),i[3*t+1]=u.GetValue(1),i[3*t+2]=u.GetValue(2);o.destroy(u);for(let e=0;e<r;++e){let r=s.GetAttribute(n,e),i=function(e,n,r,o,a){let i;let u=o.num_components()*a,s=[function(){},function(){i=new e.DracoInt8Array(u),n.GetAttributeInt8ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Int8Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){i=new e.DracoInt8Array(u),n.GetAttributeUInt8ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Uint8Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){i=new e.DracoInt16Array(u),n.GetAttributeInt16ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Int16Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){i=new e.DracoInt16Array(u),n.GetAttributeUInt16ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Uint16Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){i=new e.DracoInt32Array(u),n.GetAttributeInt32ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Int32Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){i=new e.DracoInt32Array(u),n.GetAttributeUInt32ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Uint32Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){},function(){},function(){i=new e.DracoFloat32Array(u),n.GetAttributeFloatForAllPoints(r,o,i)||console.error("Bad stream");let t=new Float32Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t},function(){},function(){i=new e.DracoUInt8Array(u),n.GetAttributeUInt8ForAllPoints(r,o,i)||console.error("Bad stream");let t=new Uint8Array(u);for(let e=0;e<u;++e)t[e]=i.GetValue(e);return t}],l=s[o.data_type()]();return t.defined(i)&&e.destroy(i),l}(o,s,n,r,a),u=r.attribute_type(),l="unknown";u===o.POSITION?l="positions":u===o.NORMAL?l="normals":u===o.COLOR?l="colors":u===o.TEX_COORD&&(l="uv0s");let d=s.GetAttributeMetadata(n,e);if(0!==d.ptr){let e=f.NumEntries(d);for(let t=0;t<e;++t){let e=f.GetEntryName(d,t);"i3s-scale_x"===e?c.scale_x=f.GetDoubleEntry(d,"i3s-scale_x"):"i3s-scale_y"===e?c.scale_y=f.GetDoubleEntry(d,"i3s-scale_y"):"i3s-attribute-type"===e&&(l=f.GetStringEntry(d,"i3s-attribute-type"))}}t.defined(c[l])&&console.log("Attribute already exists",l),c[l]=i,"feature-index"===l&&c.featureCount++}o.destroy(n)}return o.destroy(f),o.destroy(s),c}(e):function(e,n,r,o){let a={vertexCount:0},i=new DataView(e);try{let s=0;if(a.vertexCount=i.getUint32(s,1),s+=4,a.featureCount=i.getUint32(s,1),s+=4,t.defined(r))for(let n=0;n<r.attributes.length;n++)t.defined(u[r.attributes[n]])?s=u[r.attributes[n]](a,e,s):console.error("Unknown decoder for",r.attributes[n]);else{let r=n.ordering,i=n.featureAttributeOrder;t.defined(o)&&t.defined(o.geometryData)&&t.defined(o.geometryData[0])&&t.defined(o.geometryData[0].params)&&(r=Object.keys(o.geometryData[0].params.vertexAttributes),i=Object.keys(o.geometryData[0].params.featureAttributes));for(let n=0;n<r.length;n++){let o=u[r[n]];t.defined(o)||console.log(r[n]),s=o(a,e,s)}for(let n=0;n<i.length;n++){let r=u[i[n]];t.defined(r)||console.log(i[n]),s=r(a,e,s)}}}catch(e){console.error(e)}return a.scale_x=1,a.scale_y=1,a}(e,n,r,o)}(e.binaryData,e.schema,e.bufferInfo,e.featureData);t.defined(e.geoidDataList)&&e.geoidDataList.length>0&&function(e,t,n,r,a,u,s){if(s)return;let l=i(a.longitude,a.latitude,u);for(let s=0;s<e;++s){let e=i(a.longitude+o.CesiumMath.toRadians(n*t[3*s]),a.latitude+o.CesiumMath.toRadians(r*t[3*s+1]),u);t[3*s+2]+=e-l}}(n.vertexCount,n.positions,n.scale_x,n.scale_y,e.cartographicCenter,e.geoidDataList,!1),function(e,n,a,i,u,s,l,f,c){if(0===e||!t.defined(n)||0===n.length)return;let d=new r.Ellipsoid(Math.sqrt(l.x),Math.sqrt(l.y),Math.sqrt(l.z));for(let l=0;l<e;++l){let e=3*l,y=e+1,h=e+2,b=new r.Cartographic;b.longitude=i.longitude+o.CesiumMath.toRadians(f*n[e]),b.latitude=i.latitude+o.CesiumMath.toRadians(c*n[y]),b.height=i.height+n[h];let p={};d.cartographicToCartesian(b,p),p.x-=u.x,p.y-=u.y,p.z-=u.z;let g={};if(r.Matrix3.multiplyByVector(s,p,g),n[e]=g.x,n[y]=g.y,n[h]=g.z,t.defined(a)){let t=new r.Cartesian3(a[e],a[y],a[h]),n={};r.Matrix3.multiplyByVector(s,t,n),a[e]=n.x,a[y]=n.y,a[h]=n.z}}}(n.vertexCount,n.positions,n.normals,e.cartographicCenter,e.cartesianCenter,e.parentRotation,e.ellipsoidRadiiSquare,n.scale_x,n.scale_y),t.defined(n.uv0s)&&t.defined(n["uv-region"])&&function(e,t,n){for(let r=0;r<e;++r){let e=n[4*r]/65535,o=n[4*r+1]/65535,a=(n[4*r+2]-n[4*r])/65535,i=(n[4*r+3]-n[4*r+1])/65535;t[2*r]*=a,t[2*r]+=e,t[2*r+1]*=i,t[2*r+1]+=o}}(n.vertexCount,n.uv0s,n["uv-region"]);let s=function(e,n,r,o,a,i){let u,s,l;if(0===e||!t.defined(r)||0===r.length)return{buffers:[],bufferViews:[],accessors:[],meshes:[],nodes:[],nodesInScene:[]};let f=[],c=[],d=[],y=[],h=[],b=[];t.defined(n)&&(e=n.length);let p=new Uint32Array(e);if(t.defined(n))for(let t=0;t<e;++t)p[t]=n[t];else for(let t=0;t<e;++t)p[t]=t;let g=new Blob([p],{type:"application/binary"}),m=URL.createObjectURL(g),A=e,w=r.subarray(0,3*A),I=new Blob([w],{type:"application/binary"}),C=URL.createObjectURL(I),x=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,R=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY,v=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY;for(let e=0;e<w.length/3;e++)x=Math.min(x,w[3*e+0]),L=Math.max(L,w[3*e+0]),R=Math.min(R,w[3*e+1]),O=Math.max(O,w[3*e+1]),v=Math.min(v,w[3*e+2]),_=Math.max(_,w[3*e+2]);let G=o?o.subarray(0,3*A):void 0;if(t.defined(G)){let e=new Blob([G],{type:"application/binary"});u=URL.createObjectURL(e)}let M=a?a.subarray(0,2*A):void 0;if(t.defined(M)){let e=new Blob([M],{type:"application/binary"});s=URL.createObjectURL(e)}let U=t.defined(i)?i.subarray(0,4*A):void 0;if(t.defined(U)){let e=new Blob([U],{type:"application/binary"});l=URL.createObjectURL(e)}let V=0,D=0,N=0,T=0,E=0,F={POSITION:0};return f.push({uri:C,byteLength:w.byteLength}),c.push({buffer:0,byteOffset:0,byteLength:w.byteLength,target:34962}),d.push({bufferView:0,byteOffset:0,componentType:5126,count:e,type:"VEC3",max:[x,R,v],min:[L,O,_]}),t.defined(u)&&(V=++E,F.NORMAL=V,f.push({uri:u,byteLength:G.byteLength}),c.push({buffer:V,byteOffset:0,byteLength:G.byteLength,target:34962}),d.push({bufferView:V,byteOffset:0,componentType:5126,count:e,type:"VEC3"})),t.defined(s)&&(D=++E,F.TEXCOORD_0=D,f.push({uri:s,byteLength:M.byteLength}),c.push({buffer:D,byteOffset:0,byteLength:M.byteLength,target:34962}),d.push({bufferView:D,byteOffset:0,componentType:5126,count:e,type:"VEC2"})),t.defined(l)&&(N=++E,F.COLOR_0=N,f.push({uri:l,byteLength:U.byteLength}),c.push({buffer:N,byteOffset:0,byteLength:U.byteLength,target:34962}),d.push({bufferView:N,byteOffset:0,componentType:5121,normalized:!0,count:e,type:"VEC4"})),T=++E,f.push({uri:m,byteLength:p.byteLength}),c.push({buffer:T,byteOffset:0,byteLength:p.byteLength,target:34963}),d.push({bufferView:T,byteOffset:0,componentType:5125,count:e,type:"SCALAR"}),y.push({primitives:[{attributes:F,indices:T,material:0}]}),b.push(0),h.push({mesh:0}),{buffers:f,bufferViews:c,accessors:d,meshes:y,nodes:h,nodesInScene:b}}(n.vertexCount,n.indices,n.positions,n.normals,n.uv0s,n.colors),l={};if(t.defined(n["feature-index"]))l.positions=n.positions,l.indices=n.indices,l.featureIndex=n["feature-index"],l.cartesianCenter=e.cartesianCenter,l.parentRotation=e.parentRotation;else if(t.defined(n.faceRange)){l.positions=n.positions,l.indices=n.indices,l.sourceURL=e.url,l.cartesianCenter=e.cartesianCenter,l.parentRotation=e.parentRotation,l.featureIndex=Array(n.positions.length);for(let e=0;e<n.faceRange.length-1;e+=2){let t=e/2,r=n.faceRange[e],o=n.faceRange[e+1];for(let e=r;e<=o;e++)l.featureIndex[3*e]=t,l.featureIndex[3*e+1]=t,l.featureIndex[3*e+2]=t}}return s._customAttributes=l,{meshData:s}}function l(t){a=t,self.onmessage=e(s),self.postMessage(!0)}return function(e){let n=e.data.webAssemblyConfig;if(t.defined(n))return require([n.modulePath],function(e){t.defined(n.wasmBinaryFile)?(t.defined(e)||(e=self.DracoDecoderModule),e(n).then(function(e){l(e)})):l(e())})}});