define(["./AttributeCompression-48e336db","./Matrix3-81054f0f","./Color-7d827393","./defaultValue-f6d5e6da","./IndexDatatype-d3db4e7d","./Math-2ce22ee9","./OrientedBoundingBox-cfd17917","./Matrix2-413c4048","./createTaskProcessorWorker","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./Transforms-fce95115","./combine-0c102d93","./RuntimeError-9b4ce3fb","./EllipsoidTangentPlane-82f2a887","./AxisAlignedBoundingBox-39ab50d0","./IntersectionTests-357c3d7f","./Plane-6add0ae1"],function(e,t,n,a,r,i,o,s,f,l,d,c,u,h,g,p,b,m){"use strict";let y=new t.Cartesian3,C=new t.Ellipsoid,I=new s.Rectangle,x={min:void 0,max:void 0,indexBytesPerElement:void 0},w=new t.Cartesian3,A=new t.Cartesian3,E=new t.Cartesian3,N=new t.Cartesian3,T=new t.Cartesian3,B=new t.Cartographic,k=new s.Rectangle;return f(function(f,l){let d;!function(e){let n=new Float64Array(e),a=0;x.indexBytesPerElement=n[a++],x.min=n[a++],x.max=n[a++],t.Cartesian3.unpack(n,a,y),a+=t.Cartesian3.packedLength,t.Ellipsoid.unpack(n,a,C),a+=t.Ellipsoid.packedLength,s.Rectangle.unpack(n,a,I)}(f.packedBuffer),d=2===x.indexBytesPerElement?new Uint16Array(f.indices):new Uint32Array(f.indices);let c=new Uint16Array(f.positions),u=new Uint32Array(f.counts),h=new Uint32Array(f.indexCounts),g=new Uint32Array(f.batchIds),p=new Uint32Array(f.batchTableColors),b=Array(u.length),m=I,L=x.min,O=x.max,U,P,F,M=f.minimumHeights,S=f.maximumHeights;a.defined(M)&&a.defined(S)&&(M=new Float32Array(M),S=new Float32Array(S));let D=c.length/2,R=c.subarray(0,D),_=c.subarray(D,2*D);e.AttributeCompression.zigZagDeltaDecode(R,_);let G=new Float64Array(3*D);for(U=0;U<D;++U){let e=R[U],n=_[U],a=i.CesiumMath.lerp(m.west,m.east,e/32767),r=i.CesiumMath.lerp(m.south,m.north,n/32767),o=t.Cartographic.fromRadians(a,r,0,B),s=C.cartographicToCartesian(o,w);t.Cartesian3.pack(s,G,3*U)}let V=u.length,Y=Array(V),v=Array(V),H=0,W=0;for(U=0;U<V;++U)Y[U]=H,v[U]=W,H+=u[U],W+=h[U];let z=new Float32Array(3*D*2),Z=new Uint16Array(2*D),j=new Uint32Array(v.length),q=new Uint32Array(h.length),J=[],K={};for(U=0;U<V;++U)F=p[U],a.defined(K[F])?(K[F].positionLength+=u[U],K[F].indexLength+=h[U],K[F].batchIds.push(U)):K[F]={positionLength:u[U],indexLength:h[U],offset:0,indexOffset:0,batchIds:[U]};let Q,X=0,$=0;for(F in K)if(K.hasOwnProperty(F)){(Q=K[F]).offset=X,Q.indexOffset=$;let e=2*Q.positionLength,t=2*Q.indexLength+6*Q.positionLength;X+=e,$+=t,Q.indexLength=t}let ee=[];for(F in K)K.hasOwnProperty(F)&&(Q=K[F],ee.push({color:n.Color.fromRgba(parseInt(F)),offset:Q.indexOffset,count:Q.indexLength,batchIds:Q.batchIds}));for(U=0;U<V;++U){Q=K[F=p[U]];let e=Q.offset,n=3*e,r=e,i=Y[U],s=u[U],f=g[U],l=L,c=O;a.defined(M)&&a.defined(S)&&(l=M[U],c=S[U]);let I=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,D=Number.POSITIVE_INFINITY,R=Number.NEGATIVE_INFINITY;for(P=0;P<s;++P){let e=t.Cartesian3.unpack(G,3*i+3*P,w);C.scaleToGeodeticSurface(e,e);let a=C.cartesianToCartographic(e,B),o=a.latitude,s=a.longitude;I=Math.min(o,I),x=Math.max(o,x),D=Math.min(s,D),R=Math.max(s,R);let d=C.geodeticSurfaceNormal(e,A),u=t.Cartesian3.multiplyByScalar(d,l,E),h=t.Cartesian3.add(e,u,N);u=t.Cartesian3.multiplyByScalar(d,c,u);let g=t.Cartesian3.add(e,u,T);t.Cartesian3.subtract(g,y,g),t.Cartesian3.subtract(h,y,h),t.Cartesian3.pack(g,z,n),t.Cartesian3.pack(h,z,n+3),Z[r]=f,Z[r+1]=f,n+=6,r+=2}(m=k).west=D,m.east=R,m.south=I,m.north=x,b[U]=o.OrientedBoundingBox.fromRectangle(m,L,O,C);let _=Q.indexOffset,V=v[U],H=h[U];for(j[U]=_,P=0;P<H;P+=3){let t=d[V+P]-i,n=d[V+P+1]-i,a=d[V+P+2]-i;J[_++]=2*t+e,J[_++]=2*n+e,J[_++]=2*a+e,J[_++]=2*a+1+e,J[_++]=2*n+1+e,J[_++]=2*t+1+e}for(P=0;P<s;++P){let t=P,n=(P+1)%s;J[_++]=2*t+1+e,J[_++]=2*n+e,J[_++]=2*t+e,J[_++]=2*t+1+e,J[_++]=2*n+1+e,J[_++]=2*n+e}Q.offset+=2*s,Q.indexOffset=_,q[U]=_-j[U]}J=r.IndexDatatype.createTypedArray(z.length/3,J);let et=ee.length;for(let e=0;e<et;++e){let t=ee[e].batchIds,n=0,a=t.length;for(let e=0;e<a;++e)n+=q[t[e]];ee[e].count=n}let en=function(e,t,a){let r=t.length,i=2+r*o.OrientedBoundingBox.packedLength+1+function(e){let t=e.length,a=0;for(let r=0;r<t;++r)a+=n.Color.packedLength+3+e[r].batchIds.length;return a}(a),s=new Float64Array(i),f=0;s[f++]=e,s[f++]=r;for(let e=0;e<r;++e)o.OrientedBoundingBox.pack(t[e],s,f),f+=o.OrientedBoundingBox.packedLength;let l=a.length;s[f++]=l;for(let e=0;e<l;++e){let t=a[e];n.Color.pack(t.color,s,f),f+=n.Color.packedLength,s[f++]=t.offset,s[f++]=t.count;let r=t.batchIds,i=r.length;s[f++]=i;for(let e=0;e<i;++e)s[f++]=r[e]}return s}(2===J.BYTES_PER_ELEMENT?r.IndexDatatype.UNSIGNED_SHORT:r.IndexDatatype.UNSIGNED_INT,b,ee);return l.push(z.buffer,J.buffer,j.buffer,q.buffer,Z.buffer,en.buffer),{positions:z.buffer,indices:J.buffer,indexOffsets:j.buffer,indexCounts:q.buffer,batchIds:Z.buffer,packedBuffer:en.buffer}})});