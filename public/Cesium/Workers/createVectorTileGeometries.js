define(["./Transforms-fce95115","./BoxGeometry-61fa3148","./Matrix3-81054f0f","./Color-7d827393","./CylinderGeometry-966ff1e5","./defaultValue-f6d5e6da","./EllipsoidGeometry-fd18adbd","./IndexDatatype-d3db4e7d","./Matrix2-413c4048","./createTaskProcessorWorker","./Math-2ce22ee9","./combine-0c102d93","./RuntimeError-9b4ce3fb","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./GeometryAttribute-81ff775c","./GeometryAttributes-1e4ddcd2","./GeometryOffsetAttribute-2579b8d2","./VertexFormat-fbdec922","./CylinderGeometryLibrary-f49f33a8"],function(e,t,n,r,i,a,o,d,s,l,f,c,u,h,b,p,y,x,g,m){"use strict";function C(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}let I=new n.Cartesian3,M=s.Matrix4.packedLength+n.Cartesian3.packedLength,k=s.Matrix4.packedLength+2,B=s.Matrix4.packedLength+n.Cartesian3.packedLength,w=n.Cartesian3.packedLength+1,A={modelMatrix:new s.Matrix4,boundingVolume:new e.BoundingSphere};function O(e,t){let r=t*M,i=n.Cartesian3.unpack(e,r,I);r+=n.Cartesian3.packedLength;let a=s.Matrix4.unpack(e,r,A.modelMatrix);s.Matrix4.multiplyByScale(a,i,a);let o=A.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=Math.sqrt(3),A}function L(e,t){let r=t*k,i=e[r++],a=e[r++],o=n.Cartesian3.fromElements(i,i,a,I),d=s.Matrix4.unpack(e,r,A.modelMatrix);s.Matrix4.multiplyByScale(d,o,d);let l=A.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,l.center),l.radius=Math.sqrt(2),A}function v(e,t){let r=t*B,i=n.Cartesian3.unpack(e,r,I);r+=n.Cartesian3.packedLength;let a=s.Matrix4.unpack(e,r,A.modelMatrix);s.Matrix4.multiplyByScale(a,i,a);let o=A.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,o.center),o.radius=1,A}function E(e,t){let r=t*w,i=e[r++],a=n.Cartesian3.unpack(e,r,I),o=s.Matrix4.fromTranslation(a,A.modelMatrix);s.Matrix4.multiplyByUniformScale(o,i,o);let d=A.boundingVolume;return n.Cartesian3.clone(n.Cartesian3.ZERO,d.center),d.radius=1,A}let U=new n.Cartesian3;function G(t,i,o,d,l){if(!a.defined(i))return;let f=o.length,c=d.attributes.position.values,u=d.indices,h=t.positions,b=t.vertexBatchIds,p=t.indices,y=t.batchIds,x=t.batchTableColors,g=t.batchedIndices,m=t.indexOffsets,I=t.indexCounts,M=t.boundingVolumes,k=t.modelMatrix,B=t.center,w=t.positionOffset,A=t.batchIdIndex,O=t.indexOffset,L=t.batchedIndicesOffset;for(let t=0;t<f;++t){let a=l(i,t),d=a.modelMatrix;s.Matrix4.multiply(k,d,d);let f=o[t],v=c.length;for(let e=0;e<v;e+=3){let t=n.Cartesian3.unpack(c,e,U);s.Matrix4.multiplyByPoint(d,t,t),n.Cartesian3.subtract(t,B,t),n.Cartesian3.pack(t,h,3*w+e),b[A++]=f}let E=u.length;for(let e=0;e<E;++e)p[O+e]=u[e]+w;let G=t+L;g[G]=new C({offset:O,count:E,color:r.Color.fromRgba(x[f]),batchIds:[f]}),y[G]=f,m[G]=O,I[G]=E,M[G]=e.BoundingSphere.transform(a.boundingVolume,d),w+=v/3,O+=E}t.positionOffset=w,t.batchIdIndex=A,t.indexOffset=O,t.batchedIndicesOffset+=f}let S=new n.Cartesian3,V=new s.Matrix4;return l(function(l,f){let c=a.defined(l.boxes)?new Float32Array(l.boxes):void 0,u=a.defined(l.boxBatchIds)?new Uint16Array(l.boxBatchIds):void 0,h=a.defined(l.cylinders)?new Float32Array(l.cylinders):void 0,b=a.defined(l.cylinderBatchIds)?new Uint16Array(l.cylinderBatchIds):void 0,p=a.defined(l.ellipsoids)?new Float32Array(l.ellipsoids):void 0,y=a.defined(l.ellipsoidBatchIds)?new Uint16Array(l.ellipsoidBatchIds):void 0,x=a.defined(l.spheres)?new Float32Array(l.spheres):void 0,g=a.defined(l.sphereBatchIds)?new Uint16Array(l.sphereBatchIds):void 0,m=a.defined(c)?u.length:0,C=a.defined(h)?b.length:0,I=a.defined(p)?y.length:0,M=a.defined(x)?g.length:0,k=t.BoxGeometry.getUnitBox(),B=i.CylinderGeometry.getUnitCylinder(),w=o.EllipsoidGeometry.getUnitEllipsoid(),A=k.attributes.position.values,U=B.attributes.position.values,T=w.attributes.position.values,F=A.length*m;F+=U.length*C+T.length*(I+M);let R=k.indices,Z=B.indices,D=w.indices,P=R.length*m;P+=Z.length*C+D.length*(I+M);let q=new Float32Array(F),W=new Uint16Array(F/3),_=d.IndexDatatype.createTypedArray(F/3,P),N=m+C+I+M,Y=new Uint16Array(N),j=Array(N),z=new Uint32Array(N),H=new Uint32Array(N),J=Array(N);!function(e){let t=new Float64Array(e),r=0;n.Cartesian3.unpack(t,r,S),r+=n.Cartesian3.packedLength,s.Matrix4.unpack(t,r,V)}(l.packedBuffer);let K={batchTableColors:new Uint32Array(l.batchTableColors),positions:q,vertexBatchIds:W,indices:_,batchIds:Y,batchedIndices:j,indexOffsets:z,indexCounts:H,boundingVolumes:J,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:V,center:S};G(K,c,u,k,O),G(K,h,b,B,L),G(K,p,y,w,v),G(K,x,g,w,E);let Q=function(t,n,i){let a=i.length,o=2+a*e.BoundingSphere.packedLength+1+function(e){let t=e.length,n=0;for(let i=0;i<t;++i)n+=r.Color.packedLength+3+e[i].batchIds.length;return n}(n),d=new Float64Array(o),s=0;d[s++]=t,d[s++]=a;for(let t=0;t<a;++t)e.BoundingSphere.pack(i[t],d,s),s+=e.BoundingSphere.packedLength;let l=n.length;d[s++]=l;for(let e=0;e<l;++e){let t=n[e];r.Color.pack(t.color,d,s),s+=r.Color.packedLength,d[s++]=t.offset,d[s++]=t.count;let i=t.batchIds,a=i.length;d[s++]=a;for(let e=0;e<a;++e)d[s++]=i[e]}return d}(_.BYTES_PER_ELEMENT,j,J);return f.push(q.buffer,W.buffer,_.buffer),f.push(Y.buffer,z.buffer,H.buffer),f.push(Q.buffer),{positions:q.buffer,vertexBatchIds:W.buffer,indices:_.buffer,indexOffsets:z.buffer,indexCounts:H.buffer,batchIds:Y.buffer,packedBuffer:Q.buffer}})});