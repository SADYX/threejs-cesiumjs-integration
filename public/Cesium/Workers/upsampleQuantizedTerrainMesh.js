define(["./AttributeCompression-48e336db","./Transforms-fce95115","./Matrix2-413c4048","./Matrix3-81054f0f","./defaultValue-f6d5e6da","./TerrainEncoding-bd5c9ed5","./IndexDatatype-d3db4e7d","./Math-2ce22ee9","./OrientedBoundingBox-cfd17917","./createTaskProcessorWorker","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./combine-0c102d93","./RuntimeError-9b4ce3fb","./EllipsoidTangentPlane-82f2a887","./AxisAlignedBoundingBox-39ab50d0","./IntersectionTests-357c3d7f","./Plane-6add0ae1"],function(e,t,i,n,s,r,h,u,o,d,l,p,a,f,c,g,m,x){"use strict";var C={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,r,h){let u,o,d,l,p,a,f,c,g;s.defined(h)?h.length=0:h=[],t?(u=i<e,o=n<e,d=r<e):(u=i>e,o=n>e,d=r>e);let m=u+o+d;return 1===m?u?(l=(e-i)/(n-i),p=(e-i)/(r-i),h.push(1),h.push(2),1!==p&&(h.push(-1),h.push(0),h.push(2),h.push(p)),1!==l&&(h.push(-1),h.push(0),h.push(1),h.push(l))):o?(a=(e-n)/(r-n),f=(e-n)/(i-n),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==a&&(h.push(-1),h.push(1),h.push(2),h.push(a))):d&&(c=(e-r)/(i-r),g=(e-r)/(n-r),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===m?u||i===e?o||n===e?d||r===e||(p=(e-i)/(r-i),a=(e-n)/(r-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(p),h.push(-1),h.push(1),h.push(2),h.push(a)):(g=(e-r)/(n-r),l=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(l)):(f=(e-n)/(i-n),c=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==m&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,r,h,u,o,d,l){let p=i-o,a=o-h,f=u-d,c=r-d,g=1/(f*p+a*c),m=t-d,x=e-o,C=(f*x+a*m)*g,w=(-c*x+p*m)*g,B=1-C-w;return s.defined(l)?(l.x=C,l.y=w,l.z=B,l):new n.Cartesian3(C,w,B)},computeLineSegmentLineSegmentIntersection:function(e,t,n,r,h,u,o,d,l){let p=(d-u)*(n-e)-(o-h)*(r-t);if(0===p)return;let a=((o-h)*(t-u)-(d-u)*(e-h))/p,f=((n-e)*(t-u)-(r-t)*(e-h))/p;return a>=0&&a<=1&&f>=0&&f<=1?(s.defined(l)||(l=new i.Cartesian2),l.x=e+a*(n-e),l.y=t+a*(r-t),l):void 0}};let w=[],B=[],y=[],I=new n.Cartographic,A=new n.Cartesian3,b=[],v=[],T=[],M=[],z=[],V=new n.Cartesian3,N=new t.BoundingSphere,E=new o.OrientedBoundingBox,R=new i.Cartesian2,H=new n.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return s.defined(e)||(e=new O),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){let n=t+1;return -1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return s.defined(this.index)},O.prototype.getH=function(){return s.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return s.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return s.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};let S=new i.Cartesian2,U=-1,F=[new n.Cartesian3,new n.Cartesian3],P=[new n.Cartesian3,new n.Cartesian3];function D(t,i){let s=F[++U],r=P[U];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),A=n.Cartesian3.lerp(s,r,t.ratio,A),n.Cartesian3.normalize(A,A),e.AttributeCompression.octEncode(A,i),--U,i}O.prototype.getNormalX=function(){return s.defined(this.index)?this.normalBuffer[2*this.index]:(S=D(this,S)).x},O.prototype.getNormalY=function(){return s.defined(this.index)?this.normalBuffer[2*this.index+1]:(S=D(this,S)).y};let W=[];function X(e,t,i,n,r,h,u,o,d){if(0===u.length)return;let l=0,p=0;for(;p<u.length;)p=W[l++].initializeFromClipResult(u,p,o);for(let r=0;r<l;++r){let u=W[r];if(u.isIndexed())u.newIndex=h[u.index],u.uBuffer=e,u.vBuffer=t,u.heightBuffer=i,d&&(u.normalBuffer=n);else{let r=u.getKey();if(s.defined(h[r]))u.newIndex=h[r];else{let s=e.length;e.push(u.getU()),t.push(u.getV()),i.push(u.getH()),d&&(n.push(u.getNormalX()),n.push(u.getNormalY())),u.newIndex=s,h[r]=s}}}3===l?(r.push(W[0].newIndex),r.push(W[1].newIndex),r.push(W[2].newIndex)):4===l&&(r.push(W[0].newIndex),r.push(W[1].newIndex),r.push(W[2].newIndex),r.push(W[0].newIndex),r.push(W[2].newIndex),r.push(W[3].newIndex))}return W.push(new O),W.push(new O),W.push(new O),W.push(new O),d(function(e,s){let d,l,p,a,f,c,g;let m=e.isEastChild,x=e.isNorthChild,S=m?16383:0,U=m?32767:16383,F=x?16383:0,P=x?32767:16383,D=b,W=v,k=T,K=z;D.length=0,W.length=0,k.length=0,K.length=0;let L=M;L.length=0;let Y={},_=e.vertices,G=e.indices;G=G.subarray(0,e.indexCountWithoutSkirts);let J=r.TerrainEncoding.clone(e.encoding),Z=J.hasVertexNormals,j=0,q=e.vertexCountWithoutSkirts,Q=e.minimumHeight,$=e.maximumHeight,ee=Array(q),et=Array(q),ei=Array(q),en=Z?Array(2*q):void 0;for(l=0,p=0;l<q;++l,p+=2){let e=J.decodeTextureCoordinates(_,l,R);if(d=J.decodeHeight(_,l),a=u.CesiumMath.clamp(32767*e.x|0,0,32767),f=u.CesiumMath.clamp(32767*e.y|0,0,32767),ei[l]=u.CesiumMath.clamp((d-Q)/($-Q)*32767|0,0,32767),a<20&&(a=0),f<20&&(f=0),32767-a<20&&(a=32767),32767-f<20&&(f=32767),ee[l]=a,et[l]=f,Z){let e=J.getOctEncodedNormal(_,l,H);en[p]=e.x,en[p+1]=e.y}(m&&a>=16383||!m&&a<=16383)&&(x&&f>=16383||!x&&f<=16383)&&(Y[l]=j,D.push(a),W.push(f),k.push(ei[l]),Z&&(K.push(en[p]),K.push(en[p+1])),++j)}let es=[];es.push(new O),es.push(new O),es.push(new O);let er=[];for(er.push(new O),er.push(new O),er.push(new O),l=0;l<G.length;l+=3){let e=G[l],t=G[l+1],i=G[l+2],n=ee[e],s=ee[t],r=ee[i];es[0].initializeIndexed(ee,et,ei,en,e),es[1].initializeIndexed(ee,et,ei,en,t),es[2].initializeIndexed(ee,et,ei,en,i);let h=C.clipTriangleAtAxisAlignedThreshold(16383,m,n,s,r,w);(c=0)>=h.length||(c=er[0].initializeFromClipResult(h,c,es))>=h.length||(c=er[1].initializeFromClipResult(h,c,es))>=h.length||(c=er[2].initializeFromClipResult(h,c,es),X(D,W,k,K,L,Y,C.clipTriangleAtAxisAlignedThreshold(16383,x,er[0].getV(),er[1].getV(),er[2].getV(),B),er,Z),c<h.length&&(er[2].clone(er[1]),er[2].initializeFromClipResult(h,c,es),X(D,W,k,K,L,Y,C.clipTriangleAtAxisAlignedThreshold(16383,x,er[0].getV(),er[1].getV(),er[2].getV(),B),er,Z)))}let eh=m?-32767:0,eu=x?-32767:0,eo=[],ed=[],el=[],ep=[],ea=Number.MAX_VALUE,ef=-ea,ec=y;ec.length=0;let eg=n.Ellipsoid.clone(e.ellipsoid),em=i.Rectangle.clone(e.childRectangle),ex=em.north,eC=em.south,ew=em.east,eB=em.west;for(ew<eB&&(ew+=u.CesiumMath.TWO_PI),l=0;l<D.length;++l)(a=Math.round(D[l]))<=S?(eo.push(l),a=0):a>=U?(el.push(l),a=32767):a=2*a+eh,D[l]=a,(f=Math.round(W[l]))<=F?(ed.push(l),f=0):f>=P?(ep.push(l),f=32767):f=2*f+eu,W[l]=f,(d=u.CesiumMath.lerp(Q,$,k[l]/32767))<ea&&(ea=d),d>ef&&(ef=d),k[l]=d,I.longitude=u.CesiumMath.lerp(eB,ew,a/32767),I.latitude=u.CesiumMath.lerp(eC,ex,f/32767),I.height=d,eg.cartographicToCartesian(I,A),ec.push(A.x),ec.push(A.y),ec.push(A.z);let ey=t.BoundingSphere.fromVertices(ec,n.Cartesian3.ZERO,3,N),eI=o.OrientedBoundingBox.fromRectangle(em,ea,ef,eg,E),eA=new r.EllipsoidalOccluder(eg).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(ey.center,ec,3,ey.center,ea,V),eb=ef-ea,ev=new Uint16Array(D.length+W.length+k.length);for(l=0;l<D.length;++l)ev[l]=D[l];let eT=D.length;for(l=0;l<W.length;++l)ev[eT+l]=W[l];for(eT+=W.length,l=0;l<k.length;++l)ev[eT+l]=32767*(k[l]-ea)/eb;let eM=h.IndexDatatype.createTypedArray(D.length,L);if(Z){let e=new Uint8Array(K);s.push(ev.buffer,eM.buffer,e.buffer),g=e.buffer}else s.push(ev.buffer,eM.buffer);return{vertices:ev.buffer,encodedNormals:g,indices:eM.buffer,minimumHeight:ea,maximumHeight:ef,westIndices:eo,southIndices:ed,eastIndices:el,northIndices:ep,boundingSphere:ey,orientedBoundingBox:eI,horizonOcclusionPoint:eA}})});