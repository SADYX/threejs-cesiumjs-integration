define(["./defaultValue-f6d5e6da","./Matrix3-81054f0f","./ArcType-26a3f38d","./BoundingRectangle-2379df5a","./Transforms-fce95115","./Matrix2-413c4048","./ComponentDatatype-ab629b88","./EllipsoidGeodesic-2723ab86","./EllipsoidTangentPlane-82f2a887","./GeometryAttribute-81ff775c","./GeometryInstance-0318e0cd","./GeometryOffsetAttribute-2579b8d2","./GeometryPipeline-e049e700","./IndexDatatype-d3db4e7d","./Math-2ce22ee9","./PolygonGeometryLibrary-003d1689","./PolygonPipeline-61ca1579","./VertexFormat-fbdec922","./combine-0c102d93","./RuntimeError-9b4ce3fb","./WebGLConstants-7f557f93","./AxisAlignedBoundingBox-39ab50d0","./IntersectionTests-357c3d7f","./Plane-6add0ae1","./AttributeCompression-48e336db","./EncodedCartesian3-5e2017ab","./arrayRemoveDuplicates-9b636830","./EllipsoidRhumbLine-77eff028","./GeometryAttributes-1e4ddcd2"],function(e,t,o,i,r,a,n,s,l,u,d,c,p,y,m,g,h,f,b,_,P,C,x,w,T,I,A,v,E){"use strict";let G=new t.Cartographic,O=new t.Cartographic,L=new i.BoundingRectangle,V=new t.Cartesian3,H=new t.Cartesian3,D=new t.Cartesian3,N=new t.Cartesian3,F=new t.Cartesian3,R=new t.Cartesian3,M=new t.Cartesian3,S=new t.Cartesian3,B=new t.Cartesian3,k=new a.Cartesian2,z=new a.Cartesian2,W=new t.Cartesian3,Y=new r.Quaternion,U=new t.Matrix3,j=new t.Matrix3;function Q(o){let i=o.vertexFormat,s=o.geometry,l=o.shadowVolume,d=s.attributes.position.values,p=e.defined(s.attributes.st)?s.attributes.st.values:void 0,y=d.length,g=o.wall,h=o.top||g,f=o.bottom||g;if(i.st||i.normal||i.tangent||i.bitangent||l){let c;let b=o.boundingRectangle,_=o.tangentPlane,P=o.ellipsoid,C=o.stRotation,x=o.perPositionHeight,w=k;w.x=b.x,w.y=b.y;let T=i.st?new Float32Array(y/3*2):void 0;i.normal&&(c=x&&h&&!g?s.attributes.normal.values:new Float32Array(y));let I=i.tangent?new Float32Array(y):void 0,A=i.bitangent?new Float32Array(y):void 0,v=l?new Float32Array(y):void 0,E=0,L=0,Q=H,q=D,K=N,Z=!0,J=U,X=j;if(0!==C){let e=r.Quaternion.fromAxisAngle(_._plane.normal,C,Y);J=t.Matrix3.fromQuaternion(e,J),e=r.Quaternion.fromAxisAngle(_._plane.normal,-C,Y),X=t.Matrix3.fromQuaternion(e,X)}else J=t.Matrix3.clone(t.Matrix3.IDENTITY,J),X=t.Matrix3.clone(t.Matrix3.IDENTITY,X);let $=0,ee=0;h&&f&&($=y/2,ee=y/3,y/=2);for(let r=0;r<y;r+=3){let n=t.Cartesian3.fromArray(d,r,W);if(i.st&&!e.defined(p)){let e=t.Matrix3.multiplyByVector(J,n,V);e=P.scaleToGeodeticSurface(e,e);let o=_.projectPointOntoPlane(e,z);a.Cartesian2.subtract(o,w,o);let i=m.CesiumMath.clamp(o.x/b.width,0,1),r=m.CesiumMath.clamp(o.y/b.height,0,1);f&&(T[E+ee]=i,T[E+1+ee]=r),h&&(T[E]=i,T[E+1]=r),E+=2}if(i.normal||i.tangent||i.bitangent||l){let e=L+1,a=L+2;if(g){if(r+3<y){let e=t.Cartesian3.fromArray(d,r+3,F);if(Z){let o=t.Cartesian3.fromArray(d,r+y,R);x&&function(e,t,o,i){let r=i.cartesianToCartographic(e,G).height,a=i.cartesianToCartographic(t,O);a.height=r,i.cartographicToCartesian(a,t);let n=i.cartesianToCartographic(o,O);n.height=r-100,i.cartographicToCartesian(n,o)}(n,e,o,P),t.Cartesian3.subtract(e,n,e),t.Cartesian3.subtract(o,n,o),Q=t.Cartesian3.normalize(t.Cartesian3.cross(o,e,Q),Q),Z=!1}t.Cartesian3.equalsEpsilon(e,n,m.CesiumMath.EPSILON10)&&(Z=!0)}(i.tangent||i.bitangent)&&(K=P.geodeticSurfaceNormal(n,K),i.tangent&&(q=t.Cartesian3.normalize(t.Cartesian3.cross(K,Q,q),q)))}else Q=P.geodeticSurfaceNormal(n,Q),(i.tangent||i.bitangent)&&(x&&(M=t.Cartesian3.fromArray(c,L,M),S=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,M,S),S=t.Cartesian3.normalize(t.Matrix3.multiplyByVector(X,S,S),S),i.bitangent&&(B=t.Cartesian3.normalize(t.Cartesian3.cross(M,S,B),B))),q=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,Q,q),q=t.Cartesian3.normalize(t.Matrix3.multiplyByVector(X,q,q),q),i.bitangent&&(K=t.Cartesian3.normalize(t.Cartesian3.cross(Q,q,K),K)));i.normal&&(o.wall?(c[L+$]=Q.x,c[e+$]=Q.y,c[a+$]=Q.z):f&&(c[L+$]=-Q.x,c[e+$]=-Q.y,c[a+$]=-Q.z),(h&&!x||g)&&(c[L]=Q.x,c[e]=Q.y,c[a]=Q.z)),l&&(g&&(Q=P.geodeticSurfaceNormal(n,Q)),v[L+$]=-Q.x,v[e+$]=-Q.y,v[a+$]=-Q.z),i.tangent&&(o.wall?(I[L+$]=q.x,I[e+$]=q.y,I[a+$]=q.z):f&&(I[L+$]=-q.x,I[e+$]=-q.y,I[a+$]=-q.z),h&&(x?(I[L]=S.x,I[e]=S.y,I[a]=S.z):(I[L]=q.x,I[e]=q.y,I[a]=q.z))),i.bitangent&&(f&&(A[L+$]=K.x,A[e+$]=K.y,A[a+$]=K.z),h&&(x?(A[L]=B.x,A[e]=B.y,A[a]=B.z):(A[L]=K.x,A[e]=K.y,A[a]=K.z))),L+=3}}i.st&&!e.defined(p)&&(s.attributes.st=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:T})),i.normal&&(s.attributes.normal=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:c})),i.tangent&&(s.attributes.tangent=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),i.bitangent&&(s.attributes.bitangent=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),l&&(s.attributes.extrudeDirection=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:v}))}if(o.extrude&&e.defined(o.offsetAttribute)){let e=d.length/3,t=new Uint8Array(e);if(o.offsetAttribute===c.GeometryOffsetAttribute.TOP)h&&f||g?t=t.fill(1,0,e/2):h&&(t=t.fill(1));else{let e=o.offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1;t=t.fill(e)}s.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:t})}return s}let q=new t.Cartographic,K=new t.Cartographic,Z={westOverIDL:0,eastOverIDL:0},J=new s.EllipsoidGeodesic;function X(t,i,r,n,l){if(l=e.defaultValue(l,new a.Rectangle),!e.defined(t)||t.length<3)return l.west=0,l.north=0,l.south=0,l.east=0,l;if(r===o.ArcType.RHUMB)return a.Rectangle.fromCartesianArray(t,i,l);J.ellipsoid.equals(i)||(J=new s.EllipsoidGeodesic(void 0,void 0,i)),l.west=Number.POSITIVE_INFINITY,l.east=Number.NEGATIVE_INFINITY,l.south=Number.POSITIVE_INFINITY,l.north=Number.NEGATIVE_INFINITY,Z.westOverIDL=Number.POSITIVE_INFINITY,Z.eastOverIDL=Number.NEGATIVE_INFINITY;let u=1/m.CesiumMath.chordLength(n,i.maximumRadius),d=t.length,c,p=i.cartesianToCartographic(t[0],K),y=q;for(let e=1;e<d;e++)c=y,y=p,p=i.cartesianToCartographic(t[e],c),J.setEndPoints(y,p),ee(J,u,l,Z);return c=y,y=p,p=i.cartesianToCartographic(t[0],c),J.setEndPoints(y,p),ee(J,u,l,Z),l.east-l.west>Z.eastOverIDL-Z.westOverIDL&&(l.west=Z.westOverIDL,l.east=Z.eastOverIDL,l.east>m.CesiumMath.PI&&(l.east=l.east-m.CesiumMath.TWO_PI),l.west>m.CesiumMath.PI&&(l.west=l.west-m.CesiumMath.TWO_PI)),l}let $=new t.Cartographic;function ee(e,t,o,i){let r=e.surfaceDistance,a=Math.ceil(r*t),n=a>0?r/(a-1):Number.POSITIVE_INFINITY,s=0;for(let t=0;t<a;t++){let t=e.interpolateUsingSurfaceDistance(s,$);s+=n;let r=t.longitude,a=t.latitude;o.west=Math.min(o.west,r),o.east=Math.max(o.east,r),o.south=Math.min(o.south,a),o.north=Math.max(o.north,a);let l=r>=0?r:r+m.CesiumMath.TWO_PI;i.westOverIDL=Math.min(i.westOverIDL,l),i.eastOverIDL=Math.max(i.eastOverIDL,l)}}let et=[];function eo(i){let r=i.polygonHierarchy,n=e.defaultValue(i.vertexFormat,f.VertexFormat.DEFAULT),s=e.defaultValue(i.ellipsoid,t.Ellipsoid.WGS84),l=e.defaultValue(i.granularity,m.CesiumMath.RADIANS_PER_DEGREE),u=e.defaultValue(i.stRotation,0),d=i.textureCoordinates,c=e.defaultValue(i.perPositionHeight,!1),p=c&&e.defined(i.extrudedHeight),y=e.defaultValue(i.height,0),h=e.defaultValue(i.extrudedHeight,y);if(!p){let e=Math.max(y,h);h=Math.min(y,h),y=e}this._vertexFormat=f.VertexFormat.clone(n),this._ellipsoid=t.Ellipsoid.clone(s),this._granularity=l,this._stRotation=u,this._height=y,this._extrudedHeight=h,this._closeTop=e.defaultValue(i.closeTop,!0),this._closeBottom=e.defaultValue(i.closeBottom,!0),this._polygonHierarchy=r,this._perPositionHeight=c,this._perPositionHeightExtrude=p,this._shadowVolume=e.defaultValue(i.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=i.offsetAttribute,this._arcType=e.defaultValue(i.arcType,o.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this._textureCoordinates=d,this.packedLength=g.PolygonGeometryLibrary.computeHierarchyPackedLength(r,t.Cartesian3)+t.Ellipsoid.packedLength+f.VertexFormat.packedLength+(d?g.PolygonGeometryLibrary.computeHierarchyPackedLength(d,a.Cartesian2):1)+12}eo.fromPositions=function(t){return new eo({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType,textureCoordinates:t.textureCoordinates})},eo.pack=function(o,i,r){return r=e.defaultValue(r,0),r=g.PolygonGeometryLibrary.packPolygonHierarchy(o._polygonHierarchy,i,r,t.Cartesian3),t.Ellipsoid.pack(o._ellipsoid,i,r),r+=t.Ellipsoid.packedLength,f.VertexFormat.pack(o._vertexFormat,i,r),r+=f.VertexFormat.packedLength,i[r++]=o._height,i[r++]=o._extrudedHeight,i[r++]=o._granularity,i[r++]=o._stRotation,i[r++]=o._perPositionHeightExtrude?1:0,i[r++]=o._perPositionHeight?1:0,i[r++]=o._closeTop?1:0,i[r++]=o._closeBottom?1:0,i[r++]=o._shadowVolume?1:0,i[r++]=e.defaultValue(o._offsetAttribute,-1),i[r++]=o._arcType,e.defined(o._textureCoordinates)?r=g.PolygonGeometryLibrary.packPolygonHierarchy(o._textureCoordinates,i,r,a.Cartesian2):i[r++]=-1,i[r++]=o.packedLength,i};let ei=t.Ellipsoid.clone(t.Ellipsoid.UNIT_SPHERE),er=new f.VertexFormat,ea={polygonHierarchy:{}};return eo.unpack=function(o,i,r){i=e.defaultValue(i,0);let n=g.PolygonGeometryLibrary.unpackPolygonHierarchy(o,i,t.Cartesian3);i=n.startingIndex,delete n.startingIndex;let s=t.Ellipsoid.unpack(o,i,ei);i+=t.Ellipsoid.packedLength;let l=f.VertexFormat.unpack(o,i,er);i+=f.VertexFormat.packedLength;let u=o[i++],d=o[i++],c=o[i++],p=o[i++],y=1===o[i++],m=1===o[i++],h=1===o[i++],b=1===o[i++],_=1===o[i++],P=o[i++],C=o[i++],x=-1===o[i]?void 0:g.PolygonGeometryLibrary.unpackPolygonHierarchy(o,i,a.Cartesian2);e.defined(x)?(i=x.startingIndex,delete x.startingIndex):i++;let w=o[i++];return e.defined(r)||(r=new eo(ea)),r._polygonHierarchy=n,r._ellipsoid=t.Ellipsoid.clone(s,r._ellipsoid),r._vertexFormat=f.VertexFormat.clone(l,r._vertexFormat),r._height=u,r._extrudedHeight=d,r._granularity=c,r._stRotation=p,r._perPositionHeightExtrude=y,r._perPositionHeight=m,r._closeTop=h,r._closeBottom=b,r._shadowVolume=_,r._offsetAttribute=-1===P?void 0:P,r._arcType=C,r._textureCoordinates=x,r.packedLength=w,r},eo.computeRectangle=function(i,r){let a=e.defaultValue(i.granularity,m.CesiumMath.RADIANS_PER_DEGREE),n=e.defaultValue(i.arcType,o.ArcType.GEODESIC),s=i.polygonHierarchy,l=e.defaultValue(i.ellipsoid,t.Ellipsoid.WGS84);return X(s.positions,l,n,a,r)},eo.createGeometry=function(t){let o;let i=t._vertexFormat,a=t._ellipsoid,s=t._granularity,f=t._stRotation,b=t._polygonHierarchy,_=t._perPositionHeight,P=t._closeTop,C=t._closeBottom,x=t._arcType,w=t._textureCoordinates,T=e.defined(w),I=b.positions;if(I.length<3)return;let A=l.EllipsoidTangentPlane.fromPoints(I,a),v=g.PolygonGeometryLibrary.polygonsFromHierarchy(b,T,A.projectPointsOntoPlane.bind(A),!_,a),E=v.hierarchy,G=v.polygons,O=T?g.PolygonGeometryLibrary.polygonsFromHierarchy(w,!0,function(e){return e},!1).polygons:void 0;if(0===E.length)return;I=E[0].outerRing;let V=g.PolygonGeometryLibrary.computeBoundingRectangle(A.plane.normal,A.projectPointOntoPlane.bind(A),I,f,L),H=[],D=t._height,N=t._extrudedHeight,F={perPositionHeight:_,vertexFormat:i,geometry:void 0,tangentPlane:A,boundingRectangle:V,ellipsoid:a,stRotation:f,textureCoordinates:void 0,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:x};if(t._perPositionHeightExtrude||!m.CesiumMath.equalsEpsilon(D,N,0,m.CesiumMath.EPSILON2))for(F.extrude=!0,F.top=P,F.bottom=C,F.shadowVolume=t._shadowVolume,F.offsetAttribute=t._offsetAttribute,o=0;o<G.length;o++){let t;let r=function(t,o,i,r,a,n,s,u,c,p){let m;let f={walls:[]};if(s||u){let a,l;let h=g.PolygonGeometryLibrary.createGeometryFromPositions(t,o,i,r,n,c,p),b=h.attributes.position.values,_=h.indices;if(s&&u){let t=b.concat(b);a=t.length/3,(l=y.IndexDatatype.createTypedArray(a,2*_.length)).set(_);let o=_.length,r=a/2;for(m=0;m<o;m+=3){let e=l[m]+r,t=l[m+1]+r,i=l[m+2]+r;l[m+o]=i,l[m+1+o]=t,l[m+2+o]=e}if(h.attributes.position.values=t,n&&c.normal){let e=h.attributes.normal.values;h.attributes.normal.values=new Float32Array(t.length),h.attributes.normal.values.set(e)}if(c.st&&e.defined(i)){let e=h.attributes.st.values;h.attributes.st.values=new Float32Array(2*a),h.attributes.st.values=e.concat(e)}h.indices=l}else if(u){for(a=b.length/3,l=y.IndexDatatype.createTypedArray(a,_.length),m=0;m<_.length;m+=3)l[m]=_[m+2],l[m+1]=_[m+1],l[m+2]=_[m];h.indices=l}f.topAndBottom=new d.GeometryInstance({geometry:h})}let b=a.outerRing,_=l.EllipsoidTangentPlane.fromPoints(b,t),P=_.projectPointsOntoPlane(b,et),C=h.PolygonPipeline.computeWindingOrder2D(P);C===h.WindingOrder.CLOCKWISE&&(b=b.slice().reverse());let x=g.PolygonGeometryLibrary.computeWallGeometry(b,i,t,r,n,p);f.walls.push(new d.GeometryInstance({geometry:x}));let w=a.holes;for(m=0;m<w.length;m++){let e=w[m];P=(_=l.EllipsoidTangentPlane.fromPoints(e,t)).projectPointsOntoPlane(e,et),(C=h.PolygonPipeline.computeWindingOrder2D(P))===h.WindingOrder.COUNTER_CLOCKWISE&&(e=e.slice().reverse()),x=g.PolygonGeometryLibrary.computeWallGeometry(e,i,t,r,n,p),f.walls.push(new d.GeometryInstance({geometry:x}))}return f}(a,G[o],T?O[o]:void 0,s,E[o],_,P,C,i,x);P&&C?(t=r.topAndBottom,F.geometry=g.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(t.geometry,D,N,a,_)):P?((t=r.topAndBottom).geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(t.geometry.attributes.position.values,D,a,!_),F.geometry=t.geometry):C&&((t=r.topAndBottom).geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(t.geometry.attributes.position.values,N,a,!0),F.geometry=t.geometry),(P||C)&&(F.wall=!1,t.geometry=Q(F),H.push(t));let n=r.walls;F.wall=!0;for(let e=0;e<n.length;e++){let t=n[e];F.geometry=g.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(t.geometry,D,N,a,_),t.geometry=Q(F),H.push(t)}}else for(o=0;o<G.length;o++){let r=new d.GeometryInstance({geometry:g.PolygonGeometryLibrary.createGeometryFromPositions(a,G[o],T?O[o]:void 0,s,_,i,x)});if(r.geometry.attributes.position.values=h.PolygonPipeline.scaleToGeodeticHeight(r.geometry.attributes.position.values,D,a,!_),F.geometry=r.geometry,r.geometry=Q(F),e.defined(t._offsetAttribute)){let e=r.geometry.attributes.position.values.length,o=t._offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1,i=new Uint8Array(e/3).fill(o);r.geometry.attributes.applyOffset=new u.GeometryAttribute({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:i})}H.push(r)}let R=p.GeometryPipeline.combineInstances(H)[0];R.attributes.position.values=new Float64Array(R.attributes.position.values),R.indices=y.IndexDatatype.createTypedArray(R.attributes.position.values.length/3,R.indices);let M=R.attributes,S=r.BoundingSphere.fromVertices(M.position.values);return i.position||delete M.position,new u.Geometry({attributes:M,indices:R.indices,primitiveType:R.primitiveType,boundingSphere:S,offsetAttribute:t._offsetAttribute})},eo.createShadowVolume=function(e,t,o){let i=e._granularity,r=e._ellipsoid,a=t(i,r),n=o(i,r);return new eo({polygonHierarchy:e._polygonHierarchy,ellipsoid:r,stRotation:e._stRotation,granularity:i,perPositionHeight:!1,extrudedHeight:a,height:n,vertexFormat:f.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(eo.prototype,{rectangle:{get:function(){if(!e.defined(this._rectangle)){let e=this._polygonHierarchy.positions;this._rectangle=X(e,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){let t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];let o=e._ellipsoid,i=e._polygonHierarchy.positions,r=e.rectangle;return u.Geometry._textureCoordinateRotationPoints(i,t,o,r)}(this)),this._textureCoordinateRotationPoints}}}),function(o,i){return e.defined(i)&&(o=eo.unpack(o,i)),o._ellipsoid=t.Ellipsoid.clone(o._ellipsoid),eo.createGeometry(o)}});