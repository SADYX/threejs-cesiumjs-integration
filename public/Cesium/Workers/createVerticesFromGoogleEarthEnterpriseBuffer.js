define(["./AxisAlignedBoundingBox-39ab50d0","./Transforms-fce95115","./Matrix2-413c4048","./Matrix3-81054f0f","./defaultValue-f6d5e6da","./TerrainEncoding-bd5c9ed5","./Math-2ce22ee9","./OrientedBoundingBox-cfd17917","./RuntimeError-9b4ce3fb","./WebMercatorProjection-943e2226","./createTaskProcessorWorker","./combine-0c102d93","./AttributeCompression-48e336db","./ComponentDatatype-ab629b88","./WebGLConstants-7f557f93","./EllipsoidTangentPlane-82f2a887","./IntersectionTests-357c3d7f","./Plane-6add0ae1"],function(e,t,i,n,a,r,o,s,u,l,h,d,c,g,m,p,f,I){"use strict";let E=Uint16Array.BYTES_PER_ELEMENT,T=Int32Array.BYTES_PER_ELEMENT,C=Uint32Array.BYTES_PER_ELEMENT,M=Float32Array.BYTES_PER_ELEMENT,x=Float64Array.BYTES_PER_ELEMENT;function N(e,t,i){i=a.defaultValue(i,o.CesiumMath);let n=e.length;for(let a=0;a<n;++a)if(i.equalsEpsilon(e[a],t,o.CesiumMath.EPSILON12))return a;return -1}let b=new n.Cartographic,S=new n.Cartesian3,B=new n.Cartesian3,P=new n.Cartesian3,A=new i.Matrix4;function y(e,t,r,s,u,l,h,d,c,g,m){let p=d.length;for(let f=0;f<p;++f){let I=d[f],E=I.cartographic,T=I.index,C=e.length,M=E.longitude,x=E.latitude;x=o.CesiumMath.clamp(x,-o.CesiumMath.PI_OVER_TWO,o.CesiumMath.PI_OVER_TWO);let N=E.height-h.skirtHeight;h.hMin=Math.min(h.hMin,N),n.Cartographic.fromRadians(M,x,N,b),g&&(b.longitude+=c),g?f===p-1?b.latitude+=m:0===f&&(b.latitude-=m):b.latitude+=c;let B=h.ellipsoid.cartographicToCartesian(b);e.push(B),t.push(N),r.push(i.Cartesian2.clone(r[T])),s.length>0&&s.push(s[T]),u.length>0&&u.push(u[T]),i.Matrix4.multiplyByPoint(h.toENU,B,S);let P=h.minimum,A=h.maximum;n.Cartesian3.minimumByComponent(S,P,P),n.Cartesian3.maximumByComponent(S,A,A);let y=h.lastBorderPoint;if(a.defined(y)){let e=y.index;l.push(e,C-1,C,C,T,e)}h.lastBorderPoint=I}}return h(function(h,d){h.ellipsoid=n.Ellipsoid.clone(h.ellipsoid),h.rectangle=i.Rectangle.clone(h.rectangle);let c=function(h,d,c,g,m,p,f,I,R,w,_){let W,v,F,O,V,Y,U,k,H;a.defined(g)?(W=g.west,v=g.south,F=g.east,O=g.north,V=g.width,Y=g.height):(W=o.CesiumMath.toRadians(m.west),v=o.CesiumMath.toRadians(m.south),F=o.CesiumMath.toRadians(m.east),O=o.CesiumMath.toRadians(m.north),V=o.CesiumMath.toRadians(g.width),Y=o.CesiumMath.toRadians(g.height));let L=[v,O],D=[W,F],G=t.Transforms.eastNorthUpToFixedFrame(d,c),j=i.Matrix4.inverseTransformation(G,A);R&&(U=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(v),k=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-U));let z=1!==p,q=new DataView(h),J=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,Q=B;Q.x=Number.POSITIVE_INFINITY,Q.y=Number.POSITIVE_INFINITY,Q.z=Number.POSITIVE_INFINITY;let X=P;X.x=Number.NEGATIVE_INFINITY,X.y=Number.NEGATIVE_INFINITY,X.z=Number.NEGATIVE_INFINITY;let Z,$,ee=0,et=0,ei=0;for($=0;$<4;++$){let e=ee;Z=q.getUint32(e,!0),e+=C;let t=o.CesiumMath.toRadians(180*q.getFloat64(e,!0));e+=x,-1===N(D,t)&&D.push(t);let i=o.CesiumMath.toRadians(180*q.getFloat64(e,!0));e+=x,-1===N(L,i)&&L.push(i),e+=2*x;let n=q.getInt32(e,!0);e+=T,et+=n,ei+=3*(n=q.getInt32(e,!0)),ee+=Z+C}let en=[],ea=[],er=Array(et),eo=Array(et),es=Array(et),eu=R?Array(et):[],el=z?Array(et):[],eh=Array(ei),ed=[],ec=[],eg=[],em=[],ep=0,ef=0;for(ee=0,$=0;$<4;++$){Z=q.getUint32(ee,!0),ee+=C;let e=ee,t=o.CesiumMath.toRadians(180*q.getFloat64(ee,!0));ee+=x;let a=o.CesiumMath.toRadians(180*q.getFloat64(ee,!0));ee+=x;let r=o.CesiumMath.toRadians(180*q.getFloat64(ee,!0)),s=.5*r;ee+=x;let h=o.CesiumMath.toRadians(180*q.getFloat64(ee,!0)),d=.5*h;ee+=x;let g=q.getInt32(ee,!0);ee+=T;let m=q.getInt32(ee,!0);ee+=T+T;let p=Array(g);for(let e=0;e<g;++e){let u=t+q.getUint8(ee++)*r;b.longitude=u;let g=a+q.getUint8(ee++)*h;b.latitude=g;let m=q.getFloat32(ee,!0);if(ee+=M,0!==m&&m<_&&(m*=-Math.pow(2,w)),m*=6371010,b.height=m,-1!==N(D,u)||-1!==N(L,g)){let t=N(en,b,n.Cartographic);if(-1!==t){p[e]=ea[t];continue}en.push(n.Cartographic.clone(b)),ea.push(ep)}p[e]=ep,Math.abs(u-W)<s?ed.push({index:ep,cartographic:n.Cartographic.clone(b)}):Math.abs(u-F)<s?eg.push({index:ep,cartographic:n.Cartographic.clone(b)}):Math.abs(g-v)<d?ec.push({index:ep,cartographic:n.Cartographic.clone(b)}):Math.abs(g-O)<d&&em.push({index:ep,cartographic:n.Cartographic.clone(b)}),J=Math.min(m,J),K=Math.max(m,K),es[ep]=m;let f=c.cartographicToCartesian(b);if(er[ep]=f,R&&(eu[ep]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(g)-U)*k),z){let e=c.geodeticSurfaceNormal(f);el[ep]=e}i.Matrix4.multiplyByPoint(j,f,S),n.Cartesian3.minimumByComponent(S,Q,Q),n.Cartesian3.maximumByComponent(S,X,X);let I=(u-W)/(F-W);I=o.CesiumMath.clamp(I,0,1);let E=(g-v)/(O-v);E=o.CesiumMath.clamp(E,0,1),eo[ep]=new i.Cartesian2(I,E),++ep}let f=3*m;for(let e=0;e<f;++e,++ef)eh[ef]=p[q.getUint16(ee,!0)],ee+=E;if(Z!==ee-e)throw new u.RuntimeError("Invalid terrain tile.")}er.length=ep,eo.length=ep,es.length=ep,R&&(eu.length=ep),z&&(el.length=ep);let eI=ep,eE=ef,eT={hMin:J,lastBorderPoint:void 0,skirtHeight:I,toENU:j,ellipsoid:c,minimum:Q,maximum:X};if(ed.sort(function(e,t){return t.cartographic.latitude-e.cartographic.latitude}),ec.sort(function(e,t){return e.cartographic.longitude-t.cartographic.longitude}),eg.sort(function(e,t){return e.cartographic.latitude-t.cartographic.latitude}),em.sort(function(e,t){return t.cartographic.longitude-e.cartographic.longitude}),y(er,es,eo,eu,el,eh,eT,ed,-.00001*V,!0,-.00001*Y),y(er,es,eo,eu,el,eh,eT,ec,-.00001*Y,!1),y(er,es,eo,eu,el,eh,eT,eg,1e-5*V,!0,1e-5*Y),y(er,es,eo,eu,el,eh,eT,em,1e-5*Y,!1),ed.length>0&&em.length>0){let e=ed[0].index,t=em[em.length-1].index,i=er.length-1;eh.push(t,i,eI,eI,e,t)}et=er.length;let eC=t.BoundingSphere.fromPoints(er);a.defined(g)&&(H=s.OrientedBoundingBox.fromRectangle(g,J,K,c));let eM=new r.EllipsoidalOccluder(c).computeHorizonCullingPointPossiblyUnderEllipsoid(d,er,J),ex=new e.AxisAlignedBoundingBox(Q,X,d),eN=new r.TerrainEncoding(d,ex,eT.hMin,K,G,!1,R,z,p,f),eb=new Float32Array(et*eN.stride),eS=0;for(let e=0;e<et;++e)eS=eN.encode(eb,eS,er[e],eo[e],es[e],void 0,eu[e],el[e]);let eB=ed.map(function(e){return e.index}).reverse(),eP=ec.map(function(e){return e.index}).reverse(),eA=eg.map(function(e){return e.index}).reverse(),ey=em.map(function(e){return e.index}).reverse();return eP.unshift(eA[eA.length-1]),eP.push(eB[0]),ey.unshift(eB[eB.length-1]),ey.push(eA[0]),{vertices:eb,indices:new Uint16Array(eh),maximumHeight:K,minimumHeight:J,encoding:eN,boundingSphere3D:eC,orientedBoundingBox:H,occludeePointInScaledSpace:eM,vertexCountWithoutSkirts:eI,indexCountWithoutSkirts:eE,westIndicesSouthToNorth:eB,southIndicesEastToWest:eP,eastIndicesNorthToSouth:eA,northIndicesWestToEast:ey}}(h.buffer,h.relativeToCenter,h.ellipsoid,h.rectangle,h.nativeRectangle,h.exaggeration,h.exaggerationRelativeHeight,h.skirtHeight,h.includeWebMercatorT,h.negativeAltitudeExponentBias,h.negativeElevationThreshold),g=c.vertices;d.push(g.buffer);let m=c.indices;return d.push(m.buffer),{vertices:g.buffer,indices:m.buffer,numberOfAttributes:c.encoding.stride,minimumHeight:c.minimumHeight,maximumHeight:c.maximumHeight,boundingSphere3D:c.boundingSphere3D,orientedBoundingBox:c.orientedBoundingBox,occludeePointInScaledSpace:c.occludeePointInScaledSpace,encoding:c.encoding,vertexCountWithoutSkirts:c.vertexCountWithoutSkirts,indexCountWithoutSkirts:c.indexCountWithoutSkirts,westIndicesSouthToNorth:c.westIndicesSouthToNorth,southIndicesEastToWest:c.southIndicesEastToWest,eastIndicesNorthToSouth:c.eastIndicesNorthToSouth,northIndicesWestToEast:c.northIndicesWestToEast}})});