define(["exports","./Matrix3-81054f0f","./defaultValue-f6d5e6da","./Transforms-fce95115","./Math-2ce22ee9"],function(t,e,a,n,i){"use strict";let r={};function s(t,e,a){let n=t+e;return i.CesiumMath.sign(t)!==i.CesiumMath.sign(e)&&Math.abs(n/Math.max(Math.abs(t),Math.abs(e)))<a?0:n}r.computeDiscriminant=function(t,e,a){return e*e-4*t*a},r.computeRealRoots=function(t,e,a){let n;if(0===t)return 0===e?[]:[-a/e];if(0===e){if(0===a)return[0,0];let e=Math.abs(a),r=Math.abs(t);if(e<r&&e/r<i.CesiumMath.EPSILON14)return[0,0];if(e>r&&r/e<i.CesiumMath.EPSILON14||(n=-a/t)<0)return[];let s=Math.sqrt(n);return[-s,s]}if(0===a)return(n=-e/t)<0?[n,0]:[0,n];let r=s(e*e,-(4*t*a),i.CesiumMath.EPSILON14);if(r<0)return[];let o=-.5*s(e,i.CesiumMath.sign(e)*Math.sqrt(r),i.CesiumMath.EPSILON14);return e>0?[o/t,a/o]:[a/o,o/t]};let o={};function l(t,e,a,n){let i,r;let s=e/3,o=a/3,l=t*o,u=s*n,C=s*s,c=o*o,M=t*o-C,h=t*n-s*o,m=s*n-c,d=4*M*m-h*h;if(d<0){let e,a,f;C*u>=l*c?(e=t,a=M,f=-2*s*M+t*h):(e=n,a=m,f=-n*h+2*o*m);let g=-(f<0?-1:1)*Math.abs(e)*Math.sqrt(-d);r=-f+g;let p=r/2,w=p<0?-Math.pow(-p,1/3):Math.pow(p,1/3),R=r===g?-w:-a/w;return i=a<=0?w+R:-f/(w*w+R*R+a),C*u>=l*c?[(i-s)/t]:[-n/(i+o)]}let f=Math.sqrt(d),g=Math.sqrt(3)/2,p=Math.abs(Math.atan2(t*f,-(-2*s*M+t*h))/3),w=Math.cos(p);r=(i=2*Math.sqrt(-M))*w;let R=i*(-w/2-g*Math.sin(p)),S=r+R>2*s?r-s:R-s,O=S/t;p=Math.abs(Math.atan2(n*f,-(-n*h+2*o*m))/3),r=(i=2*Math.sqrt(-m))*(w=Math.cos(p)),R=i*(-w/2-g*Math.sin(p));let x=-n,y=r+R<2*o?r+o:R+o,P=x/y,N=-S*y-t*x,b=(o*N-s*(S*x))/(-s*N+o*(t*y));return O<=b?O<=P?b<=P?[O,b,P]:[O,P,b]:[P,O,b]:O<=P?[b,O,P]:b<=P?[b,P,O]:[P,b,O]}o.computeDiscriminant=function(t,e,a,n){let i=e*e,r=a*a;return 18*t*e*a*n+i*r-27*(t*t)*(n*n)-4*(t*r*a+i*e*n)},o.computeRealRoots=function(t,e,a,n){let i,s;if(0===t)return r.computeRealRoots(e,a,n);if(0===e){if(0===a){if(0===n)return[0,0,0];s=-n/t;let e=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3);return[e,e,e]}return 0===n?0===(i=r.computeRealRoots(t,0,a)).Length?[0]:[i[0],0,i[1]]:l(t,0,a,n)}return 0===a?0===n?(s=-e/t)<0?[s,0,0]:[0,0,s]:l(t,e,0,n):0===n?0===(i=r.computeRealRoots(t,e,a)).length?[0]:i[1]<=0?[i[0],i[1],0]:i[0]>=0?[0,i[0],i[1]]:[i[0],0,i[1]]:l(t,e,a,n)};let u={};function C(t,n){n=e.Cartesian3.clone(a.defaultValue(n,e.Cartesian3.ZERO)),e.Cartesian3.equals(n,e.Cartesian3.ZERO)||e.Cartesian3.normalize(n,n),this.origin=e.Cartesian3.clone(a.defaultValue(t,e.Cartesian3.ZERO)),this.direction=n}u.computeDiscriminant=function(t,e,a,n,i){let r=t*t,s=e*e,o=s*e,l=a*a,u=l*a,C=n*n,c=C*n,M=i*i;return s*l*C-4*o*c-4*t*u*C+18*t*e*a*c-27*r*C*C+256*(r*t)*(M*i)+i*(18*o*a*n-4*s*u+16*t*l*l-80*t*e*l*n-6*t*s*C+144*r*a*C)+M*(144*t*s*a-27*s*s-128*r*l-192*r*e*n)},u.computeRealRoots=function(t,e,a,n,s){if(Math.abs(t)<i.CesiumMath.EPSILON15)return o.computeRealRoots(e,a,n,s);let l=e/t,u=a/t,C=n/t,c=s/t,M=l<0?1:0;switch(M+=u<0?M+1:M,M+=C<0?M+1:M,M+=c<0?M+1:M){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return function(t,e,a,n){let s=t*t,l=e-3*s/8,u=a-e*t/2+s*t/8,C=n-a*t/4+e*s/16-3*s*s/256,c=o.computeRealRoots(1,2*l,l*l-4*C,-u*u);if(c.length>0){let e=-t/4,a=c[c.length-1];if(Math.abs(a)<i.CesiumMath.EPSILON14){let t=r.computeRealRoots(1,l,C);if(2===t.length){let a;let n=t[0],i=t[1];if(n>=0&&i>=0){let t=Math.sqrt(n),a=Math.sqrt(i);return[e-a,e-t,e+t,e+a]}if(n>=0&&i<0)return[e-(a=Math.sqrt(n)),e+a];if(n<0&&i>=0)return[e-(a=Math.sqrt(i)),e+a]}return[]}if(a>0){let t=Math.sqrt(a),n=r.computeRealRoots(1,t,(l+a-u/t)/2),i=r.computeRealRoots(1,-t,(l+a+u/t)/2);return 0!==n.length?(n[0]+=e,n[1]+=e,0!==i.length?(i[0]+=e,i[1]+=e,n[1]<=i[0]?[n[0],n[1],i[0],i[1]]:i[1]<=n[0]?[i[0],i[1],n[0],n[1]]:n[0]>=i[0]&&n[1]<=i[1]?[i[0],n[0],n[1],i[1]]:i[0]>=n[0]&&i[1]<=n[1]?[n[0],i[0],i[1],n[1]]:n[0]>i[0]&&n[0]<i[1]?[i[0],n[0],i[1],n[1]]:[n[0],i[0],n[1],i[1]]):n):0!==i.length?(i[0]+=e,i[1]+=e,i):[]}}return[]}(l,u,C,c);case 1:case 2:case 5:case 8:case 11:return function(t,e,a,n){let s=t*t,l=o.computeRealRoots(1,-2*e,a*t+e*e-4*n,s*n-a*e*t+a*a);if(l.length>0){let o,u,C,c,M,h;let m=l[0],d=e-m,f=d*d,g=t/2,p=d/2,w=f-4*n,R=s-4*m;if(m<0||w*(s+4*Math.abs(m))<R*(f+4*Math.abs(n))){let e=Math.sqrt(R);o=e/2,u=0===e?0:(t*p-a)/e}else{let e=Math.sqrt(w);o=0===e?0:(t*p-a)/e,u=e/2}0===g&&0===o?(C=0,c=0):i.CesiumMath.sign(g)===i.CesiumMath.sign(o)?c=m/(C=g+o):C=m/(c=g-o),0===p&&0===u?(M=0,h=0):i.CesiumMath.sign(p)===i.CesiumMath.sign(u)?h=n/(M=p+u):M=n/(h=p-u);let S=r.computeRealRoots(1,C,M),O=r.computeRealRoots(1,c,h);if(0!==S.length)return 0!==O.length?S[1]<=O[0]?[S[0],S[1],O[0],O[1]]:O[1]<=S[0]?[O[0],O[1],S[0],S[1]]:S[0]>=O[0]&&S[1]<=O[1]?[O[0],S[0],S[1],O[1]]:O[0]>=S[0]&&O[1]<=S[1]?[S[0],O[0],O[1],S[1]]:S[0]>O[0]&&S[0]<O[1]?[O[0],S[0],O[1],S[1]]:[S[0],O[0],S[1],O[1]]:S;if(0!==O.length)return O}return[]}(l,u,C,c);default:return}},C.clone=function(t,n){if(a.defined(t))return a.defined(n)?(n.origin=e.Cartesian3.clone(t.origin),n.direction=e.Cartesian3.clone(t.direction),n):new C(t.origin,t.direction)},C.getPoint=function(t,n,i){return a.defined(i)||(i=new e.Cartesian3),i=e.Cartesian3.multiplyByScalar(t.direction,n,i),e.Cartesian3.add(t.origin,i,i)};let c={rayPlane:function(t,n,r){a.defined(r)||(r=new e.Cartesian3);let s=t.origin,o=t.direction,l=n.normal,u=e.Cartesian3.dot(l,o);if(Math.abs(u)<i.CesiumMath.EPSILON15)return;let C=(-n.distance-e.Cartesian3.dot(l,s))/u;return C<0?void 0:(r=e.Cartesian3.multiplyByScalar(o,C,r),e.Cartesian3.add(s,r,r))}},M=new e.Cartesian3,h=new e.Cartesian3,m=new e.Cartesian3,d=new e.Cartesian3,f=new e.Cartesian3;c.rayTriangleParametric=function(t,n,r,s,o){let l,u,C,c,g;o=a.defaultValue(o,!1);let p=t.origin,w=t.direction,R=e.Cartesian3.subtract(r,n,M),S=e.Cartesian3.subtract(s,n,h),O=e.Cartesian3.cross(w,S,m),x=e.Cartesian3.dot(R,O);if(o){if(x<i.CesiumMath.EPSILON6||(l=e.Cartesian3.subtract(p,n,d),(C=e.Cartesian3.dot(l,O))<0||C>x)||(u=e.Cartesian3.cross(l,R,f),(c=e.Cartesian3.dot(w,u))<0||C+c>x))return;g=e.Cartesian3.dot(S,u)/x}else{if(Math.abs(x)<i.CesiumMath.EPSILON6)return;let t=1/x;if(l=e.Cartesian3.subtract(p,n,d),(C=e.Cartesian3.dot(l,O)*t)<0||C>1||(u=e.Cartesian3.cross(l,R,f),(c=e.Cartesian3.dot(w,u)*t)<0||C+c>1))return;g=e.Cartesian3.dot(S,u)*t}return g},c.rayTriangle=function(t,n,i,r,s,o){let l=c.rayTriangleParametric(t,n,i,r,s);if(a.defined(l)&&!(l<0))return a.defined(o)||(o=new e.Cartesian3),e.Cartesian3.multiplyByScalar(t.direction,l,o),e.Cartesian3.add(t.origin,o,o)};let g=new C;c.lineSegmentTriangle=function(t,n,i,r,s,o,l){e.Cartesian3.clone(t,g.origin),e.Cartesian3.subtract(n,t,g.direction),e.Cartesian3.normalize(g.direction,g.direction);let u=c.rayTriangleParametric(g,i,r,s,o);if(!(!a.defined(u)||u<0||u>e.Cartesian3.distance(t,n)))return a.defined(l)||(l=new e.Cartesian3),e.Cartesian3.multiplyByScalar(g.direction,u,l),e.Cartesian3.add(g.origin,l,l)};let p={root0:0,root1:0};function w(t,i,r){a.defined(r)||(r=new n.Interval);let s=t.origin,o=t.direction,l=i.center,u=i.radius*i.radius,C=e.Cartesian3.subtract(s,l,m),c=function(t,e,a,n){let i=e*e-4*t*a;if(i<0)return;if(i>0){let a=1/(2*t),r=Math.sqrt(i),s=(-e+r)*a,o=(-e-r)*a;return s<o?(n.root0=s,n.root1=o):(n.root0=o,n.root1=s),n}let r=-e/(2*t);return 0!==r?(n.root0=n.root1=r,n):void 0}(e.Cartesian3.dot(o,o),2*e.Cartesian3.dot(o,C),e.Cartesian3.magnitudeSquared(C)-u,p);if(a.defined(c))return r.start=c.root0,r.stop=c.root1,r}c.raySphere=function(t,e,n){if(n=w(t,e,n),a.defined(n)&&!(n.stop<0))return n.start=Math.max(n.start,0),n};let R=new C;c.lineSegmentSphere=function(t,n,i,r){e.Cartesian3.clone(t,R.origin);let s=e.Cartesian3.subtract(n,t,R.direction),o=e.Cartesian3.magnitude(s);if(e.Cartesian3.normalize(s,s),r=w(R,i,r),!(!a.defined(r)||r.stop<0||r.start>o))return r.start=Math.max(r.start,0),r.stop=Math.min(r.stop,o),r};let S=new e.Cartesian3,O=new e.Cartesian3;function x(t,e,a){let n=t+e;return i.CesiumMath.sign(t)!==i.CesiumMath.sign(e)&&Math.abs(n/Math.max(Math.abs(t),Math.abs(e)))<a?0:n}c.rayEllipsoid=function(t,a){let i,r,s,o,l;let u=a.oneOverRadii,C=e.Cartesian3.multiplyComponents(u,t.origin,S),c=e.Cartesian3.multiplyComponents(u,t.direction,O),M=e.Cartesian3.magnitudeSquared(C),h=e.Cartesian3.dot(C,c);if(M>1){if(h>=0)return;let t=h*h;if(i=M-1,t<(s=(r=e.Cartesian3.magnitudeSquared(c))*i))return;if(t>s){o=h*h-s,l=-h+Math.sqrt(o);let t=l/r,e=i/l;return t<e?new n.Interval(t,e):{start:e,stop:t}}let a=Math.sqrt(i/r);return new n.Interval(a,a)}return M<1?(i=M-1,o=h*h-(s=(r=e.Cartesian3.magnitudeSquared(c))*i),l=-h+Math.sqrt(o),new n.Interval(0,l/r)):h<0?(r=e.Cartesian3.magnitudeSquared(c),new n.Interval(0,-h/r)):void 0};let y=new e.Cartesian3,P=new e.Cartesian3,N=new e.Cartesian3,b=new e.Cartesian3,q=new e.Cartesian3,L=new e.Matrix3,I=new e.Matrix3,E=new e.Matrix3,z=new e.Matrix3,T=new e.Matrix3,v=new e.Matrix3,U=new e.Matrix3,W=new e.Cartesian3,B=new e.Cartesian3,V=new e.Cartographic;c.grazingAltitudeLocation=function(t,n){let s,o;let l=t.origin,C=t.direction;if(!e.Cartesian3.equals(l,e.Cartesian3.ZERO)){let t=n.geodeticSurfaceNormal(l,y);if(e.Cartesian3.dot(C,t)>=0)return l}let c=a.defined(this.rayEllipsoid(t,n)),M=n.transformPositionToScaledSpace(C,y),h=e.Cartesian3.normalize(M,M),m=e.Cartesian3.mostOrthogonalAxis(M,b),d=e.Cartesian3.normalize(e.Cartesian3.cross(m,h,P),P),f=e.Cartesian3.normalize(e.Cartesian3.cross(h,d,N),N),g=L;g[0]=h.x,g[1]=h.y,g[2]=h.z,g[3]=d.x,g[4]=d.y,g[5]=d.z,g[6]=f.x,g[7]=f.y,g[8]=f.z;let p=e.Matrix3.transpose(g,I),w=e.Matrix3.fromScale(n.radii,E),R=e.Matrix3.fromScale(n.oneOverRadii,z),S=T;S[0]=0,S[1]=-C.z,S[2]=C.y,S[3]=C.z,S[4]=0,S[5]=-C.x,S[6]=-C.y,S[7]=C.x,S[8]=0;let O=e.Matrix3.multiply(e.Matrix3.multiply(p,R,v),S,v),Z=e.Matrix3.multiply(e.Matrix3.multiply(O,w,U),g,U),A=e.Matrix3.multiplyByVector(O,l,q),D=function(t,a,n,s,o){let l;let C=o*o,c=(t[e.Matrix3.COLUMN1ROW1]-t[e.Matrix3.COLUMN2ROW2])*C,M=o*(s*x(t[e.Matrix3.COLUMN1ROW0],t[e.Matrix3.COLUMN0ROW1],i.CesiumMath.EPSILON15)+a.y),h=t[e.Matrix3.COLUMN0ROW0]*(s*s)+t[e.Matrix3.COLUMN2ROW2]*C+s*a.x+0,m=C*x(t[e.Matrix3.COLUMN2ROW1],t[e.Matrix3.COLUMN1ROW2],i.CesiumMath.EPSILON15),d=o*(s*x(t[e.Matrix3.COLUMN2ROW0],t[e.Matrix3.COLUMN0ROW2])+a.z),f=[];if(0===d&&0===m){if(0===(l=r.computeRealRoots(c,M,h)).length)return f;let t=l[0],a=Math.sqrt(Math.max(1-t*t,0));if(f.push(new e.Cartesian3(s,o*t,-(o*a))),f.push(new e.Cartesian3(s,o*t,o*a)),2===l.length){let t=l[1],a=Math.sqrt(Math.max(1-t*t,0));f.push(new e.Cartesian3(s,o*t,-(o*a))),f.push(new e.Cartesian3(s,o*t,o*a))}return f}let g=d*d,p=m*m,w=d*m,R=c*c+p,S=2*(M*c+w),O=2*h*c+M*M-p+g,y=2*(h*M-w);if(0===R&&0===S&&0===O&&0===y)return f;l=u.computeRealRoots(R,S,O,y,h*h-g);let P=l.length;if(0===P)return f;for(let t=0;t<P;++t){let a;let n=l[t],r=n*n,u=Math.max(1-r,0),C=Math.sqrt(u);a=i.CesiumMath.sign(c)===i.CesiumMath.sign(h)?x(c*r+h,M*n,i.CesiumMath.EPSILON12):i.CesiumMath.sign(h)===i.CesiumMath.sign(M*n)?x(c*r,M*n+h,i.CesiumMath.EPSILON12):x(c*r+M*n,h,i.CesiumMath.EPSILON12);let g=a*x(m*n,d,i.CesiumMath.EPSILON15);g<0?f.push(new e.Cartesian3(s,o*n,o*C)):g>0?f.push(new e.Cartesian3(s,o*n,-(o*C))):0!==C?(f.push(new e.Cartesian3(s,o*n,-(o*C))),f.push(new e.Cartesian3(s,o*n,o*C)),++t):f.push(new e.Cartesian3(s,o*n,o*C))}return f}(Z,e.Cartesian3.negate(A,y),0,0,1),F=D.length;if(F>0){let t=e.Cartesian3.clone(e.Cartesian3.ZERO,B),a=Number.NEGATIVE_INFINITY;for(let n=0;n<F;++n){s=e.Matrix3.multiplyByVector(w,e.Matrix3.multiplyByVector(g,D[n],W),W);let i=e.Cartesian3.normalize(e.Cartesian3.subtract(s,l,b),b),r=e.Cartesian3.dot(i,C);r>a&&(a=r,t=e.Cartesian3.clone(s,t))}let r=n.cartesianToCartographic(t,V);return a=i.CesiumMath.clamp(a,0,1),o=e.Cartesian3.magnitude(e.Cartesian3.subtract(t,l,b))*Math.sqrt(1-a*a),o=c?-o:o,r.height=o,n.cartographicToCartesian(r,new e.Cartesian3)}};let Z=new e.Cartesian3;c.lineSegmentPlane=function(t,n,r,s){a.defined(s)||(s=new e.Cartesian3);let o=e.Cartesian3.subtract(n,t,Z),l=r.normal,u=e.Cartesian3.dot(l,o);if(Math.abs(u)<i.CesiumMath.EPSILON6)return;let C=e.Cartesian3.dot(l,t),c=-(r.distance+C)/u;return c<0||c>1?void 0:(e.Cartesian3.multiplyByScalar(o,c,s),e.Cartesian3.add(t,s,s),s)},c.trianglePlaneIntersection=function(t,a,n,i){let r,s,o;let l=i.normal,u=i.distance,C=e.Cartesian3.dot(l,t)+u<0,M=e.Cartesian3.dot(l,a)+u<0,h=e.Cartesian3.dot(l,n)+u<0;if(1!=(o=0+((C?1:0)+(M?1:0)+(h?1:0)))&&2!==o||(r=new e.Cartesian3,s=new e.Cartesian3),1===o){if(C)return c.lineSegmentPlane(t,a,i,r),c.lineSegmentPlane(t,n,i,s),{positions:[t,a,n,r,s],indices:[0,3,4,1,2,4,1,4,3]};if(M)return c.lineSegmentPlane(a,n,i,r),c.lineSegmentPlane(a,t,i,s),{positions:[t,a,n,r,s],indices:[1,3,4,2,0,4,2,4,3]};if(h)return c.lineSegmentPlane(n,t,i,r),c.lineSegmentPlane(n,a,i,s),{positions:[t,a,n,r,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===o){if(!C)return c.lineSegmentPlane(a,t,i,r),c.lineSegmentPlane(n,t,i,s),{positions:[t,a,n,r,s],indices:[1,2,4,1,4,3,0,3,4]};if(!M)return c.lineSegmentPlane(n,a,i,r),c.lineSegmentPlane(t,a,i,s),{positions:[t,a,n,r,s],indices:[2,0,4,2,4,3,1,3,4]};if(!h)return c.lineSegmentPlane(t,n,i,r),c.lineSegmentPlane(a,n,i,s),{positions:[t,a,n,r,s],indices:[0,1,4,0,4,3,2,3,4]}}},t.IntersectionTests=c,t.Ray=C});